Contents
1 WLANAPdriverarchitecture ............................................ 119
1.1 OverviewofWLANdriver,version11.0..................................... 119
1.2 WLANcomponents ..................................................... 120
1.3 Offloadanddirect-attachdrivermodularization ............................... 123
1.4 AdditionalchangesforWLANdrivermodularization .......................... 128
1.5 WLANdriverdirectorystructurechangesbetween10.4and11.0 ................. 134
1.6 IPQ807x/IPQ807xA/IPQ817xWLANhostsoftwareoverview ................... 137
1.6.1 HWoverview ................................................. 137
1.6.2 802.11axWLANHWdatapath ................................... 138
1.6.3 IPQ807x/IPQ807xA/IPQ817xAPhostdriver ........................ 141
1.6.4 Wireless messaging interface (WMI) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 147
1.6.5 Txflow ...................................................... 150
1.6.6 Rxflow ...................................................... 151
1.7 IPQ60xxWLANhostsoftwareoverview .................................... 159
1.7.1 Hardwareoverview ............................................. 159 1.7.2 802.11axWLANhardwaredatapath ............................... 160
1.8 IPQ50xxWLANhostsoftwareoverview .................................... 161 1.8.1 Hardwareoverview ............................................. 161 1.8.2 802.11axWLANhardwaredatapath ............................... 162
1.9 QCN90xxWLANhostsoftwareoverview ................................... 163 1.9.1 Hardwareoverview ............................................. 163 1.9.2 802.11axWLANhardwaredatapath ............................... 163
1.10 QCN61xxWLANhostsoftwareoverview ................................... 164 1.10.1 Hardwareoverview ............................................. 164 1.10.2 802.11axWLANhardwaredatapath ............................... 165
1.11 WLANsoftwarearchitecturefor802.11ac ................................... 166
1.11.1 Hardwareabstractionlayer(HAL) ................................. 166
1.11.2 HALAPI.....................................................167
1.11.3 LowerMAC(LMAC) ........................................... 167
1.11.4 LMACAPI ................................................... 168
1.11.5 UpperMAC(UMAC) ........................................... 168
1.11.6 WLANAPI ................................................... 168
1.11.7 OSinterfacelayer(OSIF) ........................................ 168
1.11.8 Qualcommdriverframework(QDF) ............................... 168
Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 27
80-YA728-6 Rev. YV
MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide
Contents
80-YA728-6 Rev. YV
28
1.11.9 Atherosserviceframework(ASF) .................................
1.11.10 WLANapplications ............................................
1.11.11 UnifiedsoftwareWLANarchitecture ...............................
1.12 WLAN driver modules architecture until QCA_Networking_2016.SPF.2.0 release . . . 1.12.1 CommonWLANdrivermodules .................................. 1.12.2 Offload-specificWLANdrivermodules ............................
1.13 Wi-Ficalibrationdatamapping ............................................
1.13.1 Calibrationdatastoredinflash ....................................
1.13.2 Pre-initializationscripts .........................................
1.13.3 Wi-Fiscripts ..................................................
2 WLANAPdriverlayers ..................................................
2.1 Directorystructureofhostdriver ...........................................
2.2 ImprovementstoWMIlayerarchitecture ....................................
2.2.1 WMIlayerdesign ..............................................
2.2.2 WMIlayerinteractionswithothermodules ..........................
2.2.3 WMIinitializationsequence ......................................
2.2.4 WMIbackwardcompatibility .....................................
2.2.5 Cookieorpool-basedallocationforHTCpackets .....................
2.2.6 WMIdirectorystructure .........................................
2.3 DirectDMAframework..................................................
2.3.1 Componentinteractions .........................................
2.3.2 WMIserviceparameters .........................................
2.3.3 DMAcapabilities ..............................................
2.3.4 DMAringinitializationandconfiguration ...........................
2.3.5 DMAbufferreceive ............................................
2.3.6 Hostdriverchanges.............................................
2.3.7 Interface to the direct buffer Rx module . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
2.3.8 WMIservice,command,andevents ................................
2.3.9 Knownlimitations..............................................
2.4 Transportlayerenhancementsformodularization ..............................
2.4.1 Hostarchitecture ...............................................
2.4.2 Hostlow-leveldesign ...........................................
2.4.3 HIF/CEmajordatastructures .....................................
2.4.4 ConcurrentsupportforUSB/SIDO/PCI .............................
2.4.5 Registertablesupportfordifferentchips ............................
2.4.6 NSSWLANoffloadsupport ......................................
2.5 OptimizationofOSabstractionlayer........................................
2.6 IPQ807x/IPQ807xA/IPQ817x, IPQ60xx, QCN90xx, and QCN60xx multi-radio design 203
2.6.1 Hardwaremodeconfiguration ....................................
2.6.2 Networkinterfacename .........................................
2.6.3 WMIinterface.................................................
Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets
169
169
169
172
173
173
173
173
173
174
175
175
176
177
178
180
181
181
181
182
182
182
183
183
185
186
188
189
191
191
192
192
194
197
198
199
199
...
204 208 208
MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
2.6.4 UMAC/OLdatastructure ........................................ 213
2.6.5 WMIdatastructure ............................................. 217
2.6.6 Datastructures................................................. 219
2.6.7 Probesequence ................................................ 220
2.6.8 Removesequence .............................................. 222
2.6.9 Hardwaremodeconfiguration .................................... 223
2.6.10 WMIinterface ................................................. 223
2.6.11 Implementation ................................................ 226
2.7 UMACcomponentization ................................................ 226
2.7.1 Overview.....................................................226
2.7.2 Objectmanager ................................................ 228
2.7.3 Dispatcher—Initializationanddeinitialization ........................ 240
2.7.4 Southboundinterface ........................................... 243
2.7.5 ManagementTxandRx ......................................... 246
2.7.6 Serialization .................................................. 251
2.7.7 Schedulermodule .............................................. 260
2.8 ATFcomponentization ................................................... 263
2.8.1 ATFcomponentmodel .......................................... 265
2.8.2 ATFmoduleinitialization ........................................ 265
2.8.3 ATFmodel.................................................... 266
2.8.4 ATFsourcestructures ........................................... 276
2.8.5 CommunicationbetweenATFandexternalmodules ................... 290
2.9 SplitMAC ............................................................ 290 2.9.1 ConfiguresplitMAC ........................................... 290
2.10 DeprecatedQualcommdriverfeatures ...................................... 292
2.11 Datapathwith802.11ax.................................................. 300
2.11.1 Pluginofdatapathinterface ...................................... 300
2.11.2 Tx/Rxdatapath................................................310
2.11.3 Txflowmanager ............................................... 319
2.11.4 TCP/UDPflowmanager ......................................... 321
2.12 TxscheduleralgorithmforMU-MIMO/OFDMA .............................. 354
2.12.1 HardwareTxflow .............................................. 354
2.12.2 Datastructures/APIs ............................................ 355
2.12.3 Algorithmdescription ........................................... 356
2.12.4 Schedulerpipeline.............................................. 360
2.12.5 Queryingqueuedepthschedulers .................................. 361
2.13 GreenAPcomponentization .............................................. 364 2.13.1 Componentizeddesign .......................................... 364
2.13.2 Flowdiagrams................................................. 365
2.14 ExtenderAPcomponentization ............................................ 367 2.14.1 High-leveldesign .............................................. 367 2.14.2 Componentizationdesign ........................................ 368
2.15 QDFCBcomponentization ............................................... 369
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 29 MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
2.15.1 Assumptions .................................................. 369 2.15.2 High-leveldesign .............................................. 370 2.15.3 CommonskbcbaccessormacrosandAPIs .......................... 372
2.16 FTMcomponentization .................................................. 378 2.16.1 High-leveldesign .............................................. 378 2.16.2 Handling of FTM requests and responses through Wi-Fi driver . . . . . . . . . . 383
2.17 Target-to-hostinitializationcomponentization ................................ 383 2.17.1 High-leveldesign .............................................. 383
2.18 Statisticsframeworkcomponentization ...................................... 390 2.18.1 Designoverview ............................................... 390 2.18.2 High-leveldesignofstatisticscomponent ........................... 391
2.19 CFGINIframework.....................................................398
2.19.1 High-leveldesign .............................................. 399
2.19.2 Parsing,validating,andupdatingINI ............................... 401
2.19.3 Userconfigurationvalidationatruntime ............................ 402
2.19.4 INIdatastructuresandinitialization ................................ 403
2.19.5 INIdatastructuresandmetainformationinitialization ................. 404
2.19.6 CFGAPI .....................................................404
2.19.7 INIAPI ...................................................... 405
2.19.8 INIconfigurationandusage ...................................... 405
2.19.9 SampleINIfile ................................................ 407
2.20 Datapathstatisticscomponentization ....................................... 410
2.20.1 Modifieddatastructures ......................................... 416
2.20.2 Newstructures(movedfromUMAC) .............................. 422
2.20.3 Northboundinterfaces ........................................... 432
2.20.4 Southboundinterfaces ........................................... 439
2.21 Firmwareheaderabstractionandmemoryoptimization ......................... 443
2.22 VDEV state machine management and serialization componentization . . . . . . . . . . . . . 449
2.22.1 NeedforVDEVstatemachineandserialization ...................... 449
2.22.2 DesignchangesforVDEVstatemachineandserialization .............. 449
2.22.3 SerializationmoduleforVDEV ................................... 451
2.22.4 PDEVMLMEcomponentobject .................................. 452
2.22.5 VDEVMLMEcomponentobject .................................. 452
2.22.6 MappingtableofVDEVmanagementfunctions ...................... 453
2.22.7 MappingtableofOSIFfunctionsforVDEV operations ................ 454
2.23 ComponentizationofVDEVmanagementoperations........................... 454
2.24 SupportformultipleVDEVrestarts ........................................ 456
2.24.1 InteractionbetweenhostandFWinterface........................... 456
2.25 Host-FWhandshakeoptimizationforVDEVatruntime......................... 458
2.25.1 WMIInterface-CombinedMultiVDEVrestartresponse............... 459
2.25.2 WMI enhancements for host-FW handshake optimization for VDEV . . . . . . 460
2.26 OptimizationofVDEVdowntimeusingdeletionofallpeers ..................... 462
2.26.1 Deleteallpeerscommandsequence ................................ 463
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 30 MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide
Contents
80-YA728-6 Rev. YV
31
2.27 EnhancedlogicalandphysicaldeletionofVDEV ..............................
2.27.1 MovementoftimertothePSOCMLME ............................
2.27.2 VDEVcreate..................................................
2.27.3 VDEVup.....................................................
2.27.4 VDEVdown ..................................................
2.27.5 VDEVdelete..................................................
2.28 VDEVrestartsequenceoptimization........................................
2.29 Wi-Fitoolsunification ...................................................
2.30 Datapathlatencyoptimization ............................................
2.30.1 Designoverview ...............................................
2.31 ComponentizationofSSIDsteering ........................................ 2.31.1 DesignofSSIDsteeringcomponentization .......................... 2.31.2 SSIDsteeringsourcestructure ....................................
2.32 RTTandLOWIcomponentization .........................................
2.32.1 PublicAPsandcallflows ........................................
2.32.2 InterfacewithLOWI(osif_layer) ..................................
2.32.3 Messages processed in user context . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
2.32.4 Messages processed in host driver thread context . . . . . . . . . . . . . . . . . . . . .
2.32.5 WMIevents...................................................
2.33 Optimizationofhandshakebetweenhostandfirmware .........................
2.33.1 Serializationofrestartcommand ..................................
2.33.2 Designoverviewofserializationofrestart ...........................
2.33.3 Restartcommandfilteringlogicatserialization .......................
2.33.4 Synchronizationbetweenrestartandradardetection ...................
2.33.5 Sequencingofrestartcommandprocessing ..........................
2.34 Debugofobjectmanagerreferencecounts ...................................
2.34.1 Needforobjectreferencecountdebug ..............................
2.34.2 Implementation of the object reference count debug feature . . . . . . . . . . . . .
2.34.3 Configuretheobjectreferencecountdebugfeature ....................
2.35 Componentizationofmulticastenhancement .................................
2.35.1 CallflowforMEcomponentization ................................
2.35.2 VAPlayervariableusedbyME ...................................
2.35.3 RadiolayervariableusedbyME ..................................
2.35.4 DesignchangestoMEcomponentization............................
2.35.5 EnhancedMEdatastructures .....................................
2.35.6 HostManagedMulticast(HMMC) .................................
2.35.7 ChangesinAPIs ...............................................
2.35.8 Hy-Fitablelearning ............................................
2.36 DynamichardwaremodechangeonIPQ807xA ............................... 2.36.1 Hardwaremodeconfiguration .................................... 2.36.2 Hardwaremodesoftwareconfiguration ............................. 2.36.3 Initializationsequencefordynamichardwaremode ................... 2.36.4 Serializationfordynamichardwaremode ...........................
Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets
466
467
467
469
470
470
473
475
476
476
478
479
484
486
490
490
490
491
491
491
491
492
492
493
493
495
495
496
498
498
500
501
501
503
504
505
505
506
506
506
507
508
509
MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
2.36.5 ImpactonsecondaryWi-Fiinterface ............................... 510
2.36.6 Driverloadchanges ............................................ 511
2.36.7 UserspacecommandtoperformHWchange ........................ 512
2.36.8 Datastructuresfordynamichardwaremode ......................... 513
2.36.9 FunctionsandAPIsfordynamichardwaremode ...................... 514
2.37 VDEV sequence optimization: Deletion of all peers on QCA9980/QCA9880 platforms . . . 516
2.37.1 InteractionbetweenhostandFWinterface........................... 516
2.37.2 Guidelines for VDEV sequence optimization for deletion of all peers . . . . . 517
2.38 Enhancements to dynamic hardware mode change on IPQ807x, IPQ817x, and IPQ807xA 517
2.38.1 Architectureofdynamichardwaremodechange ...................... 518
2.38.2 Capabilitiesupdate ............................................. 526
2.38.3 OperatingModeNotification ..................................... 527
2.38.4 Datapath ..................................................... 530
2.38.5 Mappingchanges .............................................. 530
2.38.6 RegulatoryandDFS ............................................ 535
2.38.7 DFSradarprocessing ........................................... 537
2.38.8 DFSNOLconversionforHWmode ............................... 537
2.38.9 Userrequestedmodeswitchhandlingandimpact ..................... 538
2.39 IPQ8074AAP.HK10.2internal2.4GHzradiobringup ......................... 544
2.39.1 HostandtargetInterfacechanges .................................. 545
2.39.2 .Hostdriverchanges ............................................ 546
2.39.3 Firmware/HALPHYsupport ...................................... 547
2.40 QualcommTestFramework(QTF)forhostWi-Fidriver ........................ 548
2.41 Improvements for data path/control path interactions based on ID/MAC address . . . . . 549
2.41.1 GenerichandletoIDchanges ..................................... 549
2.41.2 VIDEV ID map infrastructure in IPQ807x and later chipsets data path . . . . . 550
2.41.3 Set/getAPIconvergence ......................................... 550
2.41.4 StatsAPIscleanup.............................................. 552
2.42 Sharedmemoryallocationinfirmwareforenhancedperformance ................. 553
2.42.1 NAN memory allocation using shared memory framework . . . . . . . . . . . . . . 554
2.43 SerializationofCSArestart ............................................... 557
2.44 Symmetry in the data path attach/detach and init/deinit flow sequence in IPQ807x chipsets and later 557
2.45 Improvementsforpeerdelete-handlingnotificationsatUMAC ................... 560
2.46 HAL layer convergence for QCN90xx/QCN602x, IPQ807x, and 11ax WLAN client
chipsets 561
2.47 ChangeRxMSDUandMPDUTLVforbettercachealignment................... 562
2.48 MSDUcontinuationbitsupportinWBMreleasering .......................... 562
2.48.1 Datapathsoftwareimplementation ................................ 563
2.49 PreconstructionofcachedTxsequence ...................................... 565
2.50 TQMresetwiththreadpause .............................................. 567
2.51 FurtheroptimizedTxabort/resumefordebugging ............................. 568
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 32 MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
2.52 Improvements for data path peer handling based on reference counter . . . . . . . . . . . . . . 573
2.53 Improvements for data path VDEV handling based on reference counter . . . . . . . . . . . 576
2.54 ImprovementsforcandidateselectionlogicforrepeaterSTA..................... 577
3 WLANAPdriveroperations.............................................. 581 3.1 Buffermanagement ..................................................... 581 3.1.1 WBUFabstraction.............................................. 581
3.2 Codeflow.............................................................582 3.2.1 DataPath—Partialoffload ...................................... 582 3.2.2 Offloaddatastructures .......................................... 591
3.3 Scanmoduleoverview ................................................... 593
3.3.1 Scancodeorganization .......................................... 593
3.3.2 Scanmanager ................................................. 594
3.3.3 Scandatabase ................................................. 595
3.3.4 ScanpublicAPIs...............................................595
3.3.5 Scanqueues................................................... 596
3.3.6 Controlscheduler .............................................. 596
3.3.7 Serialization .................................................. 597
3.3.8 Scanevents ................................................... 597
3.3.9 Scancache.................................................... 598
3.3.10 Addentrytoscancache ......................................... 598
3.3.11 Getscanresults ................................................ 598
3.3.12 Ageinglogic .................................................. 599
3.3.13 Duplicatedetection ............................................. 599
3.3.14 Scanfilter .................................................... 599
3.4 Scanmanagerdesign .................................................... 600
3.4.1 Scanmoduleinitialization........................................ 600
3.4.2 Scanrequest .................................................. 603
3.4.3 ScanRequestHandlerAPIs ...................................... 605
3.4.4 Scanevents ................................................... 613
3.4.5 ScandatabaseandScanentries .................................... 615
3.4.6 ScanpublicutilityAPIs ......................................... 626
3.5 Directattachscanner .................................................... 643 3.5.1 DAscanstatemachine .......................................... 643 3.5.2 UMACdependencies ........................................... 645
3.6 SerializationofpeerdeletioninWi-Fihost ................................... 647
3.6.1 Sequencingrequirements ........................................ 647
3.6.2 Designenhancements ........................................... 647
3.6.3 DesignforAPVAP(BSSNode)................................... 648
3.6.4 DesignforSTA VAP(BSSNode) ................................. 648
3.7 QCA99xx, IPQ60xx, IPQ50xx, IPQ807x/IPQ807xA/IPQ817x, and QCN90xx/QCN602x, QCN61xx FIPS-compliant encryption function 649
3.7.1 Hardwaresupport .............................................. 649
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 33 MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
80-YA728-6 Rev. YV
3.7.2 Wirelessdriversoftwaresupport .................................. 650
3.7.3 FIPStesttool:wifitool .......................................... 652
3.8 Displaysoftwarecomponentversionsafterbootupofdevice ..................... 653
3.9 Restore WLAN configuration after a firmware assert for IPQ807x/IPQ807xA/IPQ817x . .
653
3.9.1 RadioandVAPrestoration ....................................... 653
3.9.2 DFSoperations ................................................ 654
3.9.3 Recoverytime ................................................. 654
3.9.4 Configurationcommands ........................................ 654
3.9.5 Eventnotifications ............................................. 655
3.9.6 Configurationrecoverylist ....................................... 655
3.9.7 Configuration recovery (Qualcomm reference platform) . . . . . . . . . . . . . . . . 655
3.10 ReplacethedirectcallstoprintkAPIwithQDFprint .......................... 655
3.11 Receiveflowsteering.................................................... 656
3.11.1 RPSandRFSinLinuxkernel ..................................... 657
3.11.2 SteeringforpacketsfromESStoWLAN ............................ 658
3.11.3 InterworkingofcomponentsforRFS ............................... 658
3.11.4 GMACdriver ................................................. 659
3.11.5 RFSmodule................................................... 660
3.11.6 RFSdaemon .................................................. 663
3.11.7 SSDKmoduleAPIs ............................................ 664
3.11.8 Sampleconfiguration ........................................... 664
3.12 Earlydetectionofbitcorruptionduringfirmwareassert ......................... 666
3.12.1 Targetrecoveryparameters ....................................... 668
3.13 Per-radioreinitializationmechanism ........................................ 669
3.14 Rxflowidentificationbasedonprotocoltype ................................. 670
3.14.1 Guidelines for Rx flow identification based on protocol type . . . . . . . . . . . . 670
3.14.2 Design overview for Rx flow identification based on protocol type . . . . . . . 671
3.14.3 Configure Rx flow identification based on protocol type using user space commands 685
3.14.4 Verifyprotocolmetadatafeature ................................... 686
3.15 QualcommlivedumpcollectionutilitytodebugWLANhostdriver ............... 686
3.15.1 Designofthelivedumpcollectionutility ............................ 687
3.15.2 Featureoverview ............................................... 687
3.15.3 Configurelivedumpcollectionutility .............................. 688
3.15.4 Datastructuresforlivedumpcollectionutility ....................... 689
3.15.5 APIsandfunctionsforlivedumpcollectionutility .................... 690
3.16 Rxflowidentificationbasedonflowtype .................................... 693
3.16.1 GuidelinesforRxflowidentificationbasedonflowtype ............... 693
3.16.2 AboutRxflow-basedidentificationbasedonflowtype................. 694
3.16.3 DesignoverviewforRxflow-basedidentification ..................... 696
3.16.4 Callflowsequences ............................................ 699
3.16.5 WLANdriverchangesforRxflow-basedidentification ................ 701
Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 34
MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
80-YA728-6 Rev. YV
35
3.16.6 Configure Rx flow identification based on flow-type using user space commands 720
3.17 PPDUdescriptorcachingtoreduceISRpostinglatency ......................... 3.17.1 DesignoverviewofPPDUdescriptorcaching ........................
3.18 EnhancedTxabort/resumefordebugging ....................................
3.19 Multipleflowqueuesupport ..............................................
3.19.1 WLAN firmware support for multiple flow queue . . . . . . . . . . . . . . . . . . . . .
3.19.2 WLANhostdesignformultipleflowqueue..........................
3.19.3 Datastructure .................................................
3.19.4 CustomerAPI .................................................
3.19.5 Peerdeletion ..................................................
3.20 QLD-QDSSConfigurethestreambuffersize .................................
3.21 Support configure, collect and analyze PHY and MAC event traces over network . . . .
3.21.1 ConfigureMACandPHYeventsoverthenetwork ....................
3.22 Improvements for WDI path for multiple consumers per-PPDU statistics handling . . . .
3.23 Frameworkforloggingconfigurationcommands ..............................
3.23.1 Datastructureslist.............................................. 3.24 Improveddebugofobjectmanagerreferencecounts ...........................
3.24.1 Functionmodifications ..........................................
3.24.2 Memoryallocations.............................................
4 Wi-Fi platform components for IPQ807x/IPQ807xA/IPQ817x, IPQ60xx,IPQ50xx, QCN90xx/QCN602x, and QCN61xx 749
4.1 Introduction to Wi-Fi platform components IPQ807x/IPQ807xA/IPQ817x, IPQ60xx, IPQ50xx, QCN90xx/QCN602x, and QCN61xx 749
4.2 Differences between IPQ807x/IPQ807xA/IPQ817x and IPQ4019/QCA900B family of chipsets 751
4.3 Wi-Fisystemcomponents ................................................ 4.3.1 Linuxkernelconfigurationsforthesystemcomponents ................
4.4 CNSS2driver ..........................................................
4.4.1 QMI (Qualcomm messaging interface) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
4.4.2 QMIcoldbootsequence .........................................
4.4.3 Individual QMI messages and purposes . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
4.4.4 QMIinstanceIDassignment......................................
4.4.5 VariousmodesofoperationofWi-Fidriver ..........................
4.4.6 Coldbootcalibration ...........................................
4.5 OverallWi-Fidriverinitializationflow ......................................
4.6 CNSSdaemonapplicationservice ..........................................
4.6.1 CNSSDaemon ................................................
4.6.2 Caldblocation .................................................
4.6.3 Sourcecodelocation ............................................
4.6.4 ProtectionfromOOMkill........................................
4.6.5 BringupWi-Fidriverwithoutcnssdaemon ..........................
4.6.6 cnsscli .......................................................
Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets
721
723
725
728
729
730
733
734
735
735
736
738
740
742
743
744
745
746
752
753
753
754
757
760
766
767
767
771
771
771
772
772
772
772
773
MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
4.6.7 ScriptsforCNSSDaemon ....................................... 773
4.7 Targetmemoryregionsanduses ........................................... 774
4.7.1 CALDB......................................................774
4.7.2 M3DUMP....................................................775
4.7.3 QDSS ....................................................... 775
4.7.4 BDF.........................................................775
4.7.5 HREMOTE ................................................... 775
4.7.6 MHIreservedmemory .......................................... 775
4.7.7 Codeanddata ................................................. 775
4.8 Variousmemorymodessupportedbyeachtarget .............................. 776
4.8.1 IPQ807x/IPQ807xA/IPQ817x .................................... 776
4.8.2 IPQ60xx ..................................................... 778
4.8.3 QCN90xx/QCN602x............................................ 780
4.8.4 IPQ50xxnon-multi-PDlayout .................................... 782
4.8.5 IPQ50xxandQCN61xxmulti-PDmemorylayout ..................... 784
4.9 Firmwareimages ....................................................... 786
4.9.1 IPQ807x/IPQ807xA/IPQ817x PIL images (firmware file formats) . . . . . . . . 786
4.9.2 QCN90xx/QCN602xFWimagesformat ............................ 787
4.9.3 FWSUpartition ............................................... 787
4.9.4 MountingFWinrootfs .......................................... 788
4.9.5 Boarddatafiles(BDFs) ......................................... 789
4.9.6 Calibrationdata(caldata)files .................................... 789
4.10 Subsystemframework ................................................... 789 4.10.1 Eventsfromsubsystemnotifier ................................... 790 4.10.2 InterruptsfromQ6whichcancausetheSSRrecovery ................. 790 4.10.3 Subsystemrestart .............................................. 790
4.11 Remoteprocedureframework ............................................. 790
4.11.1 Q6v5WCSSRPROCroutines .................................... 791
4.11.2 QCN90xx/QCN602xrprocroutines ................................ 791
4.11.3 QCN90xx/QCN602xPCISOCresetsequence ....................... 791
4.11.4 QCN61xxrprocroutines ......................................... 792
4.12 Firmwaredownloadprocedure ............................................ 793
4.12.1 IntegratedradioFWdownloadprocedure ........................... 793
4.12.2 QCN61xxFWdownloadprocedure ................................ 793
4.12.3 PCIradioFWdownloadprocedure ................................ 793
4.13 SubsystemRecovery(SSR) ............................................... 793
4.13.1 Subsystemrestart .............................................. 793
4.13.2 InterruptsfromQ6whichcancausetheSSRrecovery ................. 794
4.13.3 BootargstodisableSSRrecovery .................................. 794
4.13.4 Wi-FiflagthatcontrolsSSRrecoveryfeature ........................ 794
4.13.5 Stepstotestsrecoveryfeaturemanually ............................. 794
4.14 SSRandfirmwarerecoveryondualradios ................................... 795
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 36 MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
4.14.1 SSR and recovery flow for integrated targets such as IPQ807x/IPQ60xx/IPQ50xx/QCN61xx 796
4.14.2 SSR and recovery flow for PCIe targets such as QCN90xx/QCN602x . . . . . 797
4.14.3 SSRrecoveryonMultiPD ....................................... 798
4.14.4 Independenttargetrecovery ...................................... 798
4.15 Modem-HostInterface(MHI) ............................................. 800
4.15.1 MHIintroduction .............................................. 800
4.15.2 Memoryspaces ................................................ 800
4.15.3 MMIOregions................................................. 800
4.15.4 Datastructures................................................. 800
4.15.5 Transferrings ................................................. 801
4.15.6 Eventrings ................................................... 802
4.15.7 MHIstates....................................................802
4.15.8 MHIinitializationandMHIcontroller .............................. 802
4.16 GenericLink(G-Link) ................................................... 803
4.16.1 G-linkoperationusinganewtransport .............................. 804
4.16.2 SalientfunctionalitiesofG-Link................................... 805
4.16.3 AdditionalfeaturesofG-Link ..................................... 805
4.16.4 MigrateSMDclientstoG-LinkAPI................................ 806
4.16.5 G-Linkpacketfragmentation ..................................... 806
4.17 Qualcommrouter(QRTR) ................................................ 807
4.17.1 QRTRoverview ............................................... 807
4.17.2 QRTR-NS .................................................... 808
4.17.3 QRTRTransports .............................................. 808
4.17.4 QRTRmessageheaderformat .................................... 808
4.17.5 QRTRpackettypes ............................................. 809
4.17.6 Enablingandstartingqrtr-ns ...................................... 809
4.18 Loadandresetsequence ................................................. 810
4.18.1 Wi-Fiupdown ................................................ 810
4.18.2 Wi-Filoadandunload........................................... 810
4.18.3 Wi-Firecover ................................................. 811
4.19 QCN90xx/QCN602x/QCN61xx PCI register access through PCI REMAP control window configuration 811
4.19.1 ExistingPCIregisteraccessmethodinpreviouschipsets ............... 811 4.19.2 Paged/windowedBARaccessinQCN90xx/QCN602x ................. 811 4.19.3 Configurethewindowregister .................................... 812 4.19.4 Examplewrites ................................................ 812 4.19.5 Barmappingdiagram ........................................... 813
4.20 QMIinteractionwithmultipleQCN90xx/QCN602x ........................... 813
4.20.1 QRTRnodeIDassignment ....................................... 813
4.20.2 CNSS2platformdrivermappingplat_devandpci_dev ................. 814
4.21 Firmwarefeatureperboard/design ......................................... 814 4.21.1 Firmware iniforQCN90xx/QCN602x/QCN61xx..................... 815
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 37 MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
80-YA728-6 Rev. YV
4.21.2 FirmwarerdpiniforIPQ807x/IPQ807xA/IPQ817x ................... 815 4.22 IRQmapping .......................................................... 815
4.22.1 QCN90xx/QCN602xMSIIRQmapping ............................ 815
4.22.2 IPQ807x/IPQ807xA/IPQ817x/IPQ60xx IRQ Mapping . . . . . . . . . . . . . . . . . 817
4.22.3 SMPaffinity .................................................. 817
4.22.4 QCN61xxIRQMapping ......................................... 817
4.22.5 QCN61xxMSIinterruptsusingQGIC .............................. 817
4.23 BDFmappingtable ..................................................... 819
4.23.1 QCN90xx/QCN602xBDFMapping ............................... 819
4.23.2 QCN90xx/QCN602x/QCN61xxBDFrelatedbootargs ................. 820
4.23.3 IPQ807x/IPQ807xA/IPQ817x and IPQ60xx radio BDF mapping . . . . . . . . . 820
4.23.4 PriorityorderinselectingBDF .................................... 820
4.23.5 BDFselectionusingOne-timeprogrammable(OTP)bits ............... 821
4.24 CaldataplacementinARTpartition......................................... 821
4.24.1 Integratedradiocaldata .......................................... 821
4.24.2 PCIradiocaldata ............................................... 821
4.25 QMIdebugging ........................................................ 821 4.25.1 Debugrelatedbootarguments .................................... 821 4.25.2 Viewingqmitransactions ........................................ 822 4.26 Ramdumpcollection .................................................... 823
4.26.1 PCIradioRamdumpcollection .................................... 823
4.26.2 IntegratedradioRamdumpcollection ............................... 823
4.26.3 IPQ50xx and QCN61xx ramdump collection in MultiPD model . . . . . . . . . . 824
4.27 Ramdumpelffilesegments ............................................... 825 4.27.1 QCN90xx/QCN602xramdumpsegments ........................... 825 4.27.2 Integratedramdumpsegments .................................... 826 4.27.3 IPQ50xxramdumpsegments ..................................... 826 4.27.4 QCN61xxramdumpsegments .................................... 827 4.28 Hotplugscripts ......................................................... 828 4.28.1 Hotplug script to mount Wi-Fi FW partition and load Wi-Fi FW . . . . . . . . . 829 4.29 athdiagoverQMIforQCN90xx/QCN602xplatforms .......................... 829
4.29.1 CLIimplementation ............................................ 829
4.29.2 Wordread .................................................... 830
4.29.3 Wordwrite.................................................... 830
4.29.4 Blockread .................................................... 830
4.29.5 Blockreadandsaveintofile ...................................... 830
4.29.6 ExamplesofathdiagoverQMIcommands........................... 831
4.30 QDSSinQCN90xx/QCN602xplatforms .................................... 832
4.30.1 OverviewofhostroleinQDSS ................................... 832
4.30.2 QDSSflow ................................................... 834
4.30.3 cnsscli ....................................................... 835
4.30.4 cnssclicommandstoenableanddisableQDSStracing ................. 835
4.30.5 cnss-daemon .................................................. 835
Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 38
MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide
Contents
80-YA728-6 Rev. YV
39
4.30.6 QMImessagessentfromcnss-daemontoFW ........................
4.30.7 CNSS2platformdriver ..........................................
4.30.8 INIfiletoautoenableQDSS .....................................
4.31 ImplementationofM3subsystemrestartinfirmware ..........................
4.31.1 SSRtriggerandrestartmasterthread ...............................
4.31.2 GlobalSSRcontext.............................................
4.31.3 Mutexlocks/semaphores .........................................
4.31.4 M3informationrecording ........................................
4.31.5 Signalsandsignalregistration ....................................
4.31.6 Threadpause .................................................
4.31.7 M3reboot ....................................................
4.31.8 Threadresumption .............................................
4.31.9 LMAC/PhyM3reset ............................................
4.31.10 PDMEM/PHYDBGlogcollection .................................
4.31.11 Enable/disableM3SSRfeatureruntime .............................
4.31.12 Fallbacktosystemreboot ........................................
4.31.13 Keydatastructuresandfunctionsinfirmware ........................
4.31.14 Logging/tracingofM3SSR ......................................
4.31.15 Parsingofm3dump ............................................
4.31.16 GuidelinesforworkingwithM3SSR...............................
4.32 QDARTandFTMdaemonchangestosupportQCN90xx/QCN602x ..............
4.32.1 Compressed ART for IPQ5018 and QCN61xx in 16M Flash . . . . . . . . . . . .
4.32.2 Caldatasavesequence...........................................
4.32.3 Caldatareadbacksequence .......................................
5 WLANAPdriverbuildandconfigurationmethods ....................... 5.1 Buildoptions .......................................................... 5.1.1 Optionsusage ................................................. 5.1.2 Minimalprofileconfiguration.....................................
5.2 Runtimeconfigurationoptions............................................. 5.2.1 wlanconfigutility .............................................. 5.2.2 Wirelesstools .................................................
5.3 ConfigurationAPI(ACFG) ...............................................
5.4 cfg80211WLANdriversupport ...........................................
5.4.1 Proprietarycfg80211driveroverview ..............................
5.4.2 Low-leveldesign...............................................
5.4.3 Scanningoperation .............................................
5.4.4 Enablecfg80211forUCIconfiguration .............................
5.4.5 cfg80211tool(iwprivreplacement) ................................
5.4.6 Assignvendorattributesforgenericcommands .......................
5.4.7 Addingnl80211supporttoproprietarytools .........................
5.4.8 QuerytheSTAdataasablockorchunks ............................
5.4.9 Applying private commands (iwpriv) using cfg80211tool . . . . . . . . . . . . . . .
Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets
835
835
836
836
838
839
839
839
839
840
840
840
841
841
842
843
843
844
845
845
846
846
848
849
850
850
850
856
856
857
858
860
860
860
861
875
877
878
880
885
893
894
MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide
Contents
5.4.10 Applying channel and ssid parameters using cfg80211tool . . . . . . . . . . . . . .
5.4.11 Usingwifitoolcommandsforcfg80211mode:examples ...............
5.4.12 Using wlanconfig commands for cfg80211 mode: examples . . . . . . . . . . . . .
5.4.13 Using miscellaneous commands for cfg80211 mode: examples . . . . . . . . . .
5.4.14 Generatehostpadconfigurationwithcfg80211 .......................
5.4.15 Mapping between nl80211 vendor commands and cfg80211tool commands
5.5 cfg80211tool improvements for command execution time and memory optimization . .
5.6 cfg80211toolsupportfor802.11axcompliance ................................
6 WLANAPmodes ........................................................ 6.1 APmode.............................................................. 6.1.1 Terminology .................................................. 6.1.2 Implementation ................................................
6.2 AP-onlymode ......................................................... 6.2.1 DatapathoptimizationsforimprovedCPUutilization .................
6.3 Clientmode ...........................................................
6.3.1 Terminology ..................................................
6.3.2 Implementation ................................................
6.3.3 Configuration .................................................
6.4 APandclientsecurity ...................................................
6.4.1 Theoryofoperation.............................................
6.4.2 Driverinterfaceforhostapimplementation ..........................
6.4.3 Configurations.................................................
6.5 Cryptoservicemoduleanddatastructures ...................................
6.5.1 RequirementsforCryptoservicemodule ............................
6.5.2 Cryptoserviceblockdiagram .....................................
6.5.3 CryptoservicemoduleinUMAC ..................................
6.5.4 Cryptodatastructures ...........................................
6.5.5 CryptoAPIdescriptions .........................................
6.6 MultipleBSSID ........................................................
6.6.1 Terminology ..................................................
6.6.2 Implementation ................................................
6.6.3 VAPmanagement ..............................................
6.6.4 Beacongeneration..............................................
6.6.5 Configuration .................................................
6.7 VLANsupport .........................................................
6.7.1 Overview.....................................................
6.7.2 Terminology ..................................................
6.7.3 Theoryofoperation.............................................
6.7.4 Implementation ................................................
6.7.5 Configuration .................................................
6.8 SupportfordynamicLANandWANforsinglenetdevice ...................... 6.8.1 LAN/WANgroupcompositions ...................................
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
894
894
894
895
896
899
901
902
903
903
903
903
908
908
912
912
912
916
916
916
919
925
925
925
926
927
927
928
930
931
931
932
932
933
933
933
933
934
934
936
936
937
40
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide
Contents
6.9 Hy-FiWLAN .......................................................... 940 6.9.1 API ......................................................... 943 6.9.2 Configuration ................................................. 944
6.10 Locationwirelessinterface(LOWI) ........................................ 945
6.10.1 LOWIclientsidelibrary ......................................... 946
6.10.2 LOWIserverprocess ........................................... 949
6.10.3 AddaLOWIclientontheAP ..................................... 952
6.10.4 Client side library classes . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 954
6.10.5 Configureround-triptimeonAPusingUCIcommands ................ 997
6.11 Positioning:LOWIonAP ................................................ 997
6.11.1 RTTtypes .................................................... 999
6.11.2 Howtoperformranging ........................................
6.11.3 Examplecallflowinhostdriver ..................................
6.11.4 Supported LOWI message types . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
6.11.5 OperationalnoteswithLOWI ....................................
6.12 StaticMACIDgeneration ...............................................
6.13 Multi-credentialsforVAP ...............................................
6.14 SpecialVAPmodeforthirdradio .........................................
6.14.1 RequirementsofspecialVAPmode ...............................
6.14.2 DesignofspecialVAPmode.....................................
6.14.3 ConfigurespecialVAPmode ....................................
6.14.4 UsageguidelinesforspecialVAPmode ............................
6.15 ManualVAPcreationanddeletionincfg80211 ..............................
6.15.1 Createinterface ...............................................
6.15.2 Deleteinterface ...............................................
6.16 EnableanddisableWi-Fiinterfaces........................................
6.17 SupportforSAE.......................................................
6.17.1 WPA3functionalitiesandSAE ...................................
6.17.2 Terminology .................................................
6.17.3 SAEsecurityproperties ........................................
6.17.4 SAEauthentication ............................................
6.17.5 Rulesforperformingtheseexchanges .............................
6.17.6 ConstructionofCommitandConfirmMessages .....................
6.17.7 Validation of commit and confirm messages . . . . . . . . . . . . . . . . . . . . . . . .
6.17.8 FramingofSAE ..............................................
6.17.9 Driverchanges ...............................................
6.17.10 ConfigureSAEusingUCIcommands .............................
6.18 OpportunisticWirelessEncryption(OWE)forOpenSSID .....................
6.18.1 OWEAKM ..................................................
6.18.2 OWEauthenticationandassociation ..............................
6.18.3 ConfigurationforOWE ........................................
6.18.4 ConfigurationforOWEtransition ................................
6.19 SuiteBinWPA3 ......................................................
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
1000
1002
1003
1004
1005
1005
1006
1006
1006
1007
1009
1009
1009
1010
1010
1012
1012
1013
1013
1014
1014
1015
1016
1017
1017
1018
1021
1021
1021
1022
1023
1024
41
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
6.20 TDMAmethod........................................................1025
6.20.1 Sampleconfigurationscenario ................................... 1026
6.20.2 Limitations .................................................. 1028
6.20.3 Sequenceofframesexchange .................................... 1029
6.21 Supportfor802.11axMBSSIE ........................................... 1031
6.21.1 MBSSIDoverview ............................................ 1031
6.21.2 RequirementsforMBSSIDsupport ............................... 1035
6.21.3 Beaconoffload ............................................... 1036
6.21.4 ChangestoWLANAP ......................................... 1037
6.21.5 ChangestoWLANSTA ........................................ 1041
6.21.6 CommunicationbetweenhostandFW ............................. 1041
6.21.7 Designenhancementstocomplywith11ax,draft3 ................... 1042
6.21.8 MBSSID changes to comply with 802.11ax specification, draft 3.x . . . . . . 1043
6.21.9 PHYparamchangeforaVAP ................................... 1044
6.21.10 MBSSIEchanges ............................................. 1044
6.21.11 GuidelinesforconfiguringMBSSIE .............................. 1045
6.21.12 EnableanddisableMBSSIDIE .................................. 1045
6.21.13 Knownlimitations ............................................ 1046
6.22 Supportfor802.11rand802.11vSTAmode ................................. 1047 6.22.1 Designoverview .............................................. 1047
6.22.2 Knownlimitations ............................................. 1049
6.23 ConfigureDPPforWFAEasyConnect ..................................... 1050
6.23.1 DPPcapabilities .............................................. 1050
6.23.2 DPPdeviceroles .............................................. 1050
6.23.3 DPPprotocolusage ............................................ 1051
6.23.4 Bootstrapping ................................................ 1054
6.23.5 ConfigureDPPusingUCIcommands ............................. 1056
6.24 IPQ807x/IPQ807xA/IPQ817x with single-radio configuration . . . . . . . . . . . . . . . . . . 1057
6.25 SupportformultiplepassphraseonVLANsforWPA2 ......................... 1058
6.25.1 Design and implementation of multiple passphrase with PSKs on VLANs . 1060 6.25.2 Sampleconfiguration .......................................... 1061
6.26 SupportforWAPIrekeymechanism ....................................... 1062
6.27 ConfigureAPIstoperformCCMencryptionanddecryption .................... 1064
6.27.1 DesignoverviewforencryptionanddecryptionofCCM............... 1064
6.27.2 CreateDISAinterface .......................................... 1066
6.28 Transmission of packets on a VAP that is different from the VAP on which it is enqueued in IPQ807x and later chipsets 1067
6.29 UCIsupporttoconfigureindividualVAPsindependently ...................... 1068
6.30 Enable single 2G internal radio only on RDP412 (IPQ807x 2G + QCN90xx/QCN602x 5G +
QCN90xx/QCN602x 6G) 1069
6.31 Configureaccesscontrolofclientsbasedonalistofstations ................... 1069
6.31.1 Configureaccesscontrolofclientsbasedonalist .................... 1070 6.31.2 Designoverviewofaccesscontrolofclientsbasedonalist ............ 1070
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 42 MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
6.32 Widebandsupportfor5GHzand6GHz .................................... 1072
6.32.1 INI and cfg80211tool configuration for wideband support . . . . . . . . . . . . . 1073
6.32.2 IEEEstandardadherenceforwidebandsupport ...................... 1074
6.32.3 ChannelSwitchAnnouncement(CSA)operation .................... 1075
6.32.4 Securitymode ................................................ 1075
6.32.5 Multi-BSSIDmode ............................................ 1076
6.32.6 DynamicChannelSelection(DCS)enhancement .................... 1076
6.32.7 Channelandoperatingclassadvertisement ......................... 1077
6.32.8 Guidelinesforworkingwithwidebandsupport ...................... 1077
6.33 Locationschedulerenhancements ......................................... 1077 6.34 Enhanced multi-BSSID advertisement AP (EMA AP) support for 6 GHz . . . . . . . . . . 1078
6.34.1 EMAAPoverview ............................................ 1078
6.34.2 KeyEMAclausesfrom802.11axdraft6.1.......................... 1082
6.34.3 SalientcapabilitiesofEMAAP .................................. 1082
6.34.4 DynamictransmitVDEVconfiguration ............................ 1083
6.34.5 TxVDEVsetup............................................... 1083
6.34.6 BSSIDandBSSIDIDx ......................................... 1086
6.34.7 DeriveBSSIDinternallyinthedriver.............................. 1088
6.34.8 Derive BSSID-IDx for non-Tx vap based on User Assigned BSSIDs . . . . . 1089
6.34.9 MBSScacheandaccessstrategy ................................. 1090
6.34.10 Notification to user space and handling Tx VDEV specific configuration . 1093
6.34.11 Handlingtx-vapwhilecreatingMBSSIDIE ........................ 1094
6.34.12 DynamicchangeinPP ......................................... 1095
6.34.13 PPmanagementmechanism ..................................... 1095
6.34.14 MaximumPPdetermination ..................................... 1096
6.34.15 Beaconbuffermanagementinhost ................................ 1096
6.34.16 SendseparatetemplatestoFW ................................... 1096
6.34.17 RNRcacheandMBSSIDcache .................................. 1097
6.34.18 Proberesponse ............................................... 1097
6.34.19 EMAAPsupportandfirmwareenhancements....................... 1099
6.34.20 Configure EMA AP and dynamic Tx VDEV using .ini and cfg80211tool settings 1104
6.34.21 Operational notes for working with EMA AP and dynamic Tx VDEV . . . . 1106
6.34.22 Steps to perform cross-band (5-7 GHz) channel switch in the wideband radio in
QCA_Networking_2020.SPF.11.3 1109
6.35 SupportforQCN9070asascanradio ...................................... 1111
6.35.1 ConfigureQCN9070asascanradio............................... 1111 6.35.2 FirmwareenhancementsforQCN9070asascanradio ................ 1113 6.35.3 HALPHYenhancementsforQCN9070asascanradio ................ 1114
7 Accelerationandoffloadfeatures ....................................... 1116 7.1 TCPsegmentationoffload ............................................... 1116 7.1.1 Implementation ............................................... 1116 7.1.2 Configuration ................................................ 1116
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 43 MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
80-YA728-6 Rev. YV
7.2 Largereceiveoffload ................................................... 1117 7.2.1 Implementation ............................................... 1117 7.2.2 Configuration ................................................ 1117
7.3 Checksumoffload ..................................................... 1117 7.3.1 Implementation ............................................... 1118
7.4 Offloadoptimizedhostdatapath .......................................... 1118
7.5 NSSWi-FioffloadonIPQ806x ........................................... 1121
7.5.1 Features ..................................................... 1122
7.5.2 Hostdriversplitarchitecture ..................................... 1122
7.5.3 Standardprofile............................................... 1123
7.5.4 Enterpriseprofile.............................................. 1124
7.6 HNATWi-Fioffload ................................................... 1124 7.6.1 QCA8327 ................................................... 1124 7.6.2 HardwareNATaccelerator ...................................... 1125 7.6.3 Configuration ................................................ 1126
7.7 Customizefull-offloadconfigurationforpeakKPI ............................ 1127
7.7.1 Loadthefull-offloadmodules.................................... 1127
7.7.2 Modify the full-offload network configuration for flash mode . . . . . . . . . . 1128
7.7.3 ModifytheEthernetMTUconfiguration ........................... 1129
7.7.4 ReduceCPUutilizations ........................................ 1130
7.7.5 Disablekernelprints ........................................... 1130
7.7.6 SigmaDUTconfigurations ...................................... 1130
7.7.7 Bypass-LANconfiguration ...................................... 1130
7.7.8 Limitation ................................................... 1131
7.8 IPQ806xIPcryptooffload ............................................... 1131 7.8.1 Drivercomponents ............................................ 1132 7.8.2 Offloadcomponents ........................................... 1132 7.8.3 CryptooffloadAPIs ........................................... 1133 7.8.4 SupportedCryptoAlgorithms ................................... 1135 7.8.5 Restrictions .................................................. 1137
7.9 IPsectunnels ......................................................... 1137 7.9.1 Campusdeployment ........................................... 1138 7.9.2 Remotebranchoffice .......................................... 1139 7.9.3 IPsecwithcryptooffload ....................................... 1140
7.10 IPsecacceleration...................................................... 1140
7.10.1 Accelerationmodel ............................................ 1141
7.10.2 APIs........................................................ 1142
7.10.3 Restrictions .................................................. 1144
7.11 IPsecbringup ......................................................... 1145
7.11.1 IPsecsetup................................................... 1145
7.11.2 MTU ....................................................... 1147
7.11.3 IPsecbringup(LANtoWAN) ................................... 1147
7.11.4 IPsecbringup(WLANtoWAN) ................................. 1150
Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 44
MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
7.11.5 VerifyNSSIPsecfeatures ....................................... 1152
7.11.6 AES-192softwarefallback ...................................... 1152
7.11.7 AES-CTR ................................................... 1152
7.11.8 Initiator ..................................................... 1153
7.11.9 Responder ................................................... 1154
7.11.10 Statistics .................................................... 1156
7.12 MultipleWAN ........................................................ 1158
7.12.1 UCIconfigurationofthemultiwan ................................ 1158
7.12.2 Samplemultiwanconnection .................................... 1159
7.12.3 Analyzethemultiwan .......................................... 1160
7.12.4 Samplemultiwantests ......................................... 1161
7.12.5 Limitations .................................................. 1162
7.13 MultipathsupportinECM ............................................... 1162
7.13.1 Singlepathimplementation ..................................... 1162
7.13.2 Multipathmodel .............................................. 1163
7.13.3 MultipathTestTopology ........................................ 1163
7.14 IPv6MAP-T.......................................................... 1164
7.14.1 MAP-Ttopology .............................................. 1164 7.14.2 Designchanges ............................................... 1165
7.15 IPv6NAPT........................................................... 1167 7.15.1 DetailedinformationontunnelingwithIPv6 ........................ 1168 7.15.2 VerifyNSSacceleration ........................................ 1169 7.15.3 Configurationcommands ....................................... 1169 7.15.4 MAP-Tconfiguration .......................................... 1170
7.16 IPv6processing ....................................................... 1176 7.16.1 IPv4toIPv6transitiononWANlink .............................. 1177
7.17 VLANtrafficseparationoverWi-Fi ....................................... 1181 7.17.1 Sampleconfigurationscenarios .................................. 1181
7.18 Linkaggregationgroup ................................................. 1183
7.18.1 LAGrequirements............................................. 1184
7.18.2 LAGarchitecture.............................................. 1185
7.18.3 HLOSupdates ................................................ 1185
7.18.4 RulepushtoNSS ............................................. 1185
7.18.5 Destructionofrules ............................................ 1186
7.18.6 Link-downevent .............................................. 1186
7.18.7 Link-upevent ................................................ 1186
7.18.8 NSSSyncNotifications ........................................ 1186
7.18.9 LAGinterfaceup/down ........................................ 1186
7.18.10 Featuretestsetup–TCP/UDP ................................... 1187
7.18.11 Determinethetypeofegressinterface ............................. 1187
7.19 LACPframework...................................................... 1188
7.19.1 Userinterfaceoflinkaggregation................................. 1191 7.19.2 Statusoflinkaggregation ....................................... 1193
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 45 MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide
Contents
80-YA728-6 Rev. YV
46
7.19.3 Userspacelinkaggregationdaemon .............................. 7.19.4 Trunkconfiguration ........................................... 7.19.5 Requirementforhardwareswitchaboutportstate .................... 7.19.6 Linkstatusnotification ......................................... 7.19.7 Failoverinlinkaggregation ..................................... 7.19.8 Integrationwithothersubsystem ................................. 7.19.9 LimitationsandNotice .........................................
7.20 802.3xflowcontrol ....................................................
7.20.1 Requirements ................................................
7.20.2 Implementation ...............................................
7.20.3 Configure802.3xflowcontrol ...................................
7.21 LANportIDhandlingNSSandIPQ40x8platforms ...........................
7.21.1 EDMAMultipleVLANs .......................................
7.21.2 Sampletopology ..............................................
7.21.3 2 VLANs (1+4) The default case . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
7.21.4 5VLANs(1+1+1+1+1) ........................................
7.21.5 2VLANs(3+2) .............................................
7.21.6 3VLANs(2+2+1) ..........................................
7.21.7 CommandstocheckSFEcounters ................................
7.21.8 SampleoutputofECMdump ....................................
7.21.9 SampleoutputofSFEdump .....................................
7.21.10 Routingandmultiflowconfigurationcommands ....................
7.21.11 CommandstodisableandenableSFE .............................
7.21.12 HNATcommands .............................................
7.21.13 HNATcounters ...............................................
7.21.14 ECMcounters ................................................
7.22 ACL-basedsteering ....................................................
7.22.1 ESSswitchACLfeature ........................................
7.22.2 GREflowsteeringusecase .....................................
7.22.3 ARPentrywithloadbalance ....................................
7.22.4 InterfaceentrywithmyMAC ....................................
7.22.5 GREtunnelidentification .......................................
7.22.6 UCIconfiguration .............................................
7.22.7 Limitations ..................................................
7.22.8 Configurationexample .........................................
7.23 MultiplePPPoEsessions ................................................
7.23.1 StartaPPPoEserver ...........................................
7.23.2 StopaPPPoEserver ...........................................
7.23.3 Sampleconfiguration ..........................................
7.23.4 CreatemultiplePPPoEsessions ..................................
7.23.5 CreatedualWANport..........................................
7.23.6 DisplayPPPoEstatistics ........................................
7.23.7 UCIcommands ...............................................
Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets
1194 1196 1197 1197 1197 1197 1198 1198 1199 1199 1200 1201 1202 1202 1202 1204 1207 1209 1211 1211 1215 1216 1222 1222 1223 1223 1223 1223 1225 1226 1227 1227 1228 1236 1236 1241 1242 1243 1243 1244 1245 1245 1246
MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
7.23.8 Addroutes ................................................... 1249
7.24 ExtendedNSSsignaling................................................. 1250
7.24.1 ConfigurationcommandsforextendedNSSsignaling ................. 1255
7.24.2 LimitationsforextendedNSSsignaling ............................ 1256
7.24.3 Sample configuration scenario for extended NSS signaling . . . . . . . . . . . . . 1256
7.25 NSS Wi-Fi offload on IPQ60xx/IPQ50xx, QCN90xx/QCN602x, QCN61xx + IPQ50xx, and IPQ807x/IPQ807xA/IPQ817x 1257
7.25.1 Overview .................................................... 1257
7.25.2 Enable/disableNSSWi-Fioffload ................................ 1259
7.25.3 NSSWi-Fioffloadprofiledifferences ............................. 1260
7.25.4 ValidateNSSWi-Fioffloadconfiguration .......................... 1260
7.25.5 CompileNSSfirmwareWi-Fisource .............................. 1261
7.25.6 Statistics .................................................... 1262
7.26 IPQ60xx/IPQ50xx/IPQ807x/IPQ807xA/IPQ817x/QCN90xx/QCN602x/QCN61xx crypto offload 1265
7.26.1 DriverinteractionintheLinuxkernel.............................. 1265
7.27 ECMfunctions ........................................................ 1267
7.27.1 Accelerationengines ........................................... 1267
7.27.2 Kernelfeaturematrix .......................................... 1267
7.27.3 ECMsources ................................................. 1268
7.27.4 ECMstate ................................................... 1268
7.28 EDMAdrivers ........................................................ 1271
7.28.1 EDMAdriverfeatures.......................................... 1272 7.28.2 EDMAdriverconfiguration ..................................... 1275
7.29 SFEprocesses ........................................................ 1280
7.29.1 SFEkernelmodules ........................................... 1280
7.29.2 Kernelmoduledependency ...................................... 1281
7.29.3 Enableshortcutforwardengine .................................. 1281
7.29.4 Disableshortcutforwardengine .................................. 1281
7.29.5 Dumpdebuginformationofshortcutforwardengine ................. 1281
7.30 QRFSoperations ...................................................... 1283 7.30.1 ConfigureQRFSusingUCI ..................................... 1283
7.30.2 ViewQRFSdebugdetails ....................................... 1284
7.31 HNAT ............................................................... 1284
7.31.1 HNATenableUCIconfiguration ................................. 1284
7.31.2 HNATdisableUCIconfiguration ................................. 1284
7.31.3 StaticNATconfiguration ....................................... 1285
7.31.4 ViewHNATentries ............................................ 1285
7.32 GREtunnelpacketflowsinNSSsystem .................................... 1285
7.32.1 TunnelAP>ACpacketflow .................................... 1285
7.32.2 TunnelAC>APpacketflow .................................... 1286
7.32.3 GREkernelmoduleHLOSsoftwaredesign ......................... 1287
7.33 IGMPandMLDsnooping ............................................... 1287
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 47 MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
7.33.1 IntroductionofHy-FiIGMP/MLDsnooping ........................ 1287
7.33.2 IGMP/MLDseparation ......................................... 1290
7.34
IPQ806x/IPQ60xx/IPQ50xx/IPQ807x/IPQ807xA/IPQ817x/QCN90xx/QCN602x/QCN61x x NSS IPSec offload 1293
7.34.1 Packetstructure ............................................... 1294
7.34.2 IPSecencapsulationheaderformat ................................ 1294
7.34.3 Padding ..................................................... 1295
7.34.4 SampleIPSecpackettransforms ................................. 1295
7.34.5 IPSecoffloadpacketflows ...................................... 1296
7.34.6 Programminginterface ......................................... 1298
7.34.7 Limitations .................................................. 1306
7.35 Knownnetworkingaccelerationlimitations ................................. 1306
7.36 NSScryptoaccelerationforHMACSHA1modeonIPQ806x ................... 1307
7.36.1 EnhancementstoCryptoAPI .................................... 1309
7.36.2 EnhancementstoCryptoCoreDriver .............................. 1314
7.36.3 Usekernelmoduletcrypttotesthmac(sha1) ........................ 1315
7.36.4 Check whether the new algorithm impacts the existing Crypto API algorithms . 1316
7.36.5 UseIPsecxfrmapplicationtotestthenewalgorithm ................. 1316
7.36.6 Limitations .................................................. 1316
7.37 GRETAPinnon-offloadmode ........................................... 1316
7.37.1 NSSclient ................................................... 1317 7.37.2 NSSdriver .................................................. 1318
7.38 GRETAPinoffloadmode ............................................... 1320 7.38.1 NSSGREchanges ............................................ 1322
7.39 ConfigureandverifytheworkingofGRETAP .............................. 1331 7.39.1 CreateaTAPinterface ......................................... 1331 7.39.2 Errorcodes .................................................. 1333 7.39.3 Sampleconfigurationscenario ................................... 1334 7.39.4 ExampleofatopologyforGRETAPfornon-offloadmode ............ 1335
7.40 GREtunnelinoffloadmode ............................................. 1336
7.40.1 GREchanges................................................. 1337
7.40.2 CommandstoconfigureIPv4GREtunnel .......................... 1339
7.41 EDMA-configurableTxqueuemapping .................................... 1339
7.42 L2TPoverIPsec....................................................... 1341 7.42.1 Sampleconfigurationscenario ................................... 1342
7.43 L2TPoverIPsecoverPPPoE............................................. 1346 7.43.1 Sampleconfigurationscenario ................................... 1347
7.44 OVPNoverview ....................................................... 1352
7.44.1 OVPNprotocoldetails ......................................... 1354
7.44.2 FeaturessupportedinNSSacceleration ............................ 1357
7.44.3 OVPNapplication—functionaldesign ............................. 1357
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 48 MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
7.44.4 OVPNdatachannelaccelerationarchitecture ....................... 1366
7.44.5 OVPNNSSdesign ............................................ 1370
7.45 MACseconQCA8081platforms.......................................... 1375
7.46 IEEE1588forQCA8081platforms........................................ 1377
7.47 Supportfibermodulefor1GbpsspeedonIPQ807x ........................... 1378
7.48 WLANredirectfeature ................................................. 1378
7.49 Tunipip6supportforinnerandouterframeworkimplementation................. 1379
7.50 GREdesignchangetoinnerandouterframework ............................ 1379
7.51 mwan3overview ...................................................... 1379
7.51.1 Limitationswithmwan3 ........................................ 1380
7.51.2 mwan3references ............................................. 1380
7.51.3 Userinterfaceforconfiguringmwan3 ............................. 1380
7.51.4 Prerequisitesforconfiguringmwan3 .............................. 1381
7.51.5 Configuremwan3 ............................................. 1381
7.51.6 Configurepolicy .............................................. 1383
7.51.7 SamplesettingsonIPQ40x ...................................... 1384
7.51.8 Verifytheworkingofmwan3 .................................... 1387
7.51.9 Troubleshootmwan3problems ................................... 1388
7.52 DTLSprotocol ........................................................ 1390 7.52.1 DTLSpacketstructure ......................................... 1390 7.52.2 DTLSoffloadinNSS .......................................... 1391
7.53 MD5algorithmforHMACandHASH ..................................... 1392
7.53.1 TCRYPTtest ................................................. 1392
7.53.2 IPsecslowpathtesting(Netkey).................................. 1393
7.54 IPv4overIPv6(464)XLATimplementationinLinux ......................... 1399
7.54.1 Architectureof464xlat ......................................... 1399
7.54.2 464xlataddresstranslation ...................................... 1400
7.54.3 ImplementationinLinux........................................ 1400
7.54.4 CLATaddresstranslationflow ................................... 1401
7.54.5 WorkingofCLAT ............................................. 1402
7.54.6 464XLATimplementationinoffload.............................. 1405
7.55 InnerandouterMAP-Tinterface .......................................... 1406
7.56 InnerandouterPPTPinterfaces........................................... 1407
7.57 Enhancementstocryptoalgorithms ........................................ 1407
7.58 PPPoE and IPv6 bridging on IPQ807x/IPQ807xA/IPQ817x, IPQ60xx/IPQ50xx, QCN61xx
+ IPQ50xx, and QCN90xx/QCN602x + IPQ807xA/IPQ60xx/IPQ50xx 1407
7.59 Inner and outer interface for IPsec on IPQ807x/IPQ807xA/IPQ817x, IPQ60xx, IPQ50xx,
QCN61xx + IPQ50xx, and QCN90xx/QCN602x + IPQ807xA/IPQ60xx/IPQ50xx 1408
7.60 FIPS certification process recommendations for NSS crypto offload on IPQ807x . . . . 1410
7.61 EthernetoverGRE ..................................................... 1411
7.62 TLSsupport .......................................................... 1411
7.63 OpenVSwitch(OVS)acceleration ......................................... 1412
7.63.1 OpenVSwitch–Basicfunctionalblocks ........................... 1414
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 49 MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
7.64 NLCFGframeworkforNSS ............................................. 1416 7.64.1 NLCFGframeworkforIPv4 ..................................... 1418 7.64.2 NLCFGframeworkforGRE .................................... 1420
7.65 PPPoEbridgeaccelerationenhancementsinNSSfirmware ..................... 1424
7.66 PacketreplicationinNSS ............................................... 1425
7.66.1 pkg/matchuserinterfaceoverview ................................ 1426
7.66.2 Masksfortheprofile ........................................... 1427
7.66.3 Matchactions ................................................ 1427
7.66.4 Configurationcommandsforpkg/match ........................... 1427
7.66.5 Modestoconfiguremirrornode .................................. 1428
7.67 ConfigurationforInterBSStrafficseparation ................................ 1429
7.68 SupportforTLS ....................................................... 1431
7.69 Packetprocessingengineandvirtualports .................................. 1432
7.70 LoadbalancingforIPSecflowsacceleratedwithcryptoengine .................. 1433
7.71 EnhancedNSSoffloadingstatistics ........................................ 1434
7.71.1 athstats-iwifiX:Thisisper-radiolevelstatistic ..................... 1435
7.71.2 apstats-v-iathx:Thisisper-VAPlevelstatistic ..................... 1438
7.71.3 wlanconfigath0list:Thisisperclient-levelstatistic .................. 1438
7.71.4 iwconfigath0:Thisisper-VAPlevelstatistic ........................ 1439
7.71.5 apstats -s -m <mac_addr>: This is per-client level statistic . . . . . . . . . . . . . 1439
7.71.6 iwpriv ath0 fc_peer_stats <mac_addr>: This is per-client DP level statistic. . . . 1441
7.72 Wi-FijitterperclientandperTID ......................................... 1443 7.72.1 DesignoverviewofWi-Fijitter .................................. 1443
7.72.2 Enableanddisplayjitterstatistics ................................. 1446
7.73 SupportforStatelessAddressTranslation(SAM)/4rd ......................... 1446
7.74 Multiple SOCs on single NSS image support on QCN90xx/QCN602x chipsets . . . . . 1448
7.75 Support for 3-tuple hash in RxOLE on QCN90xx/QCN602x chipsets . . . . . . . . . . . . . 1449
7.76 VLAN hardware acceleration support on QCN90xx/QCN602x chipsets . . . . . . . . . . . 1449
7.76.1 DesignoverviewofVLANhardwareacceleration .................... 1450
7.76.2 Hardwareexpectedbehavior ..................................... 1452
7.76.3 Configuration commands for VLAN hardware acceleration . . . . . . . . . . . . 1454
7.77 VAPinspectionmodeandNSSWi-Fioffload ................................ 1455
7.78 OpenSync—Per-clientlinkmetrics ........................................ 1457
7.78.1 Sampleoutputofper-clientlinkstatistics ........................... 1462
7.79 ExtendedsupportforStatelessAddressTranslation(SAM)/4rd .................. 1463
7.80 MirroredStreamClassificationService ..................................... 1464
7.80.1 MSCSoperations ............................................. 1464
7.80.2 MSCSprotocoloverview ....................................... 1464
7.80.3 MSCSprotocoldesignoverview ................................. 1466
7.80.4 ConfigureMSCS.............................................. 1467
7.81 AdditionalenhancementstoNSSoffloadingstatistics ......................... 1468
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 50 MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
8 Ratecontrolfeatures ................................................... 1470
8.1 Ratecontrol .......................................................... 1470
8.1.1 Theoryofoperation............................................ 1470
8.1.2 Offloadimplementation ........................................ 1471
8.1.3 Code ....................................................... 1477
8.1.4 API ........................................................ 1477
8.1.5 Configuration ................................................ 1478
8.1.6 RateControlforSpecialTrafficTypes ............................. 1479
8.1.7 SetMCSNSSrate............................................. 1479
8.2 256QAMratesupportin2.4GHzoperation................................. 1480
8.2.1 256QAMRateSupportNegotiation .............................. 1480
8.2.2 Implementation ............................................... 1481
8.2.3 CLICommands ............................................... 1481
8.3 DisableselectedMCSforanSSID ........................................ 1481
8.3.1 Theoryofoperation............................................ 1482
8.3.2 Implementation ............................................... 1482
8.3.3 Offloadimplementation ........................................ 1483
8.3.4 CLIcommands ............................................... 1483
8.3.5 Validation ................................................... 1484
8.4 DisableselectedlegacyratesforanSSID ................................... 1485
8.4.1 Purpose ..................................................... 1485
8.4.2 Overview .................................................... 1485
8.4.3 Backgroundtheory ............................................ 1485
8.4.4 Implementation ............................................... 1485
8.4.5 Configuration ................................................ 1487
8.4.6 Validation ................................................... 1487
8.4.7 Limitation ................................................... 1487
8.5 ConfigureshortguardintervalforallMCSs ................................. 1488
8.6 Rateadaptationformissingrates .......................................... 1488
8.7 802.11ax HE SU (excluding HE_NDP) proprietary HE-LTF/GI combinations . . . . . . 1489 8.7.1 Sampleconfigurationscenario ................................... 1489
8.8 SupportformulticastDRAalgorithm ...................................... 1490
8.8.1 ConfigurationcommandsformulticastDRA ........................ 1493 8.9 ConfigureHEMACandHEPHYcapabilities ............................... 1493 8.9.1 CommandstoconfigureHEMACandHEPHYcapabilities ........... 1498 8.9.2 Guidelines for configuring HE MAC and HE PHY capabilities . . . . . . . . . 1500
8.10 Disable probing in VHT20, MCS 9 rate in NSS 1 and 2 after a certain number of failures . 1501
8.11 Save calibration data to EEPROM on QCN90xx/QCN602x chipsets . . . . . . . . . . . . . . 1504
8.12 Rate control data structure optimization and caching for QCN90xx/QCN602x . . . . . . 1506
8.13 Rateadaptation/powerimbalanceoptimization ............................... 1506
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 51 MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide
Contents
9 Powermanagementtechniques ........................................ 1508
9.1 UAPSDWMMpowersave(WMM-PS) .................................... 1508
9.1.1 Terminology ................................................. 1508
9.1.2 Theoryofoperation............................................ 1509
9.1.3 WMMpower-saveadvertisement ................................. 1509
9.1.4 U-APSDenabledSTAassociates ................................. 1509
9.1.5 STAandpowermanagement .................................... 1510
9.1.6 STAandUAPSDtrigger ........................................ 1510
9.1.7 UAPSDimplementation ........................................ 1510
9.2 Powermanagement .................................................... 1514
9.2.1 Terminology ................................................. 1514
9.2.2 Theoryofoperation............................................ 1514
9.2.3 Offloadimplementation ........................................ 1515
9.3 Transmitpowercontrol(TPC) ............................................ 1516
9.3.1 Theoryofoperation............................................ 1517
9.3.2 Implementation ............................................... 1518
9.3.3 Additionalfeature ............................................. 1524
9.4 Configure transmit power for management frames per SSID . . . . . . . . . . . . . . . . . . . . 1525
9.5 AdvancedEnterprise ................................................... 1529 9.5.1 AdvancedEnterpriseAPISupport ................................ 1529
9.6 Thermalmitigationforoffloadchipsets..................................... 1534
9.6.1 Objectives ................................................... 1534
9.6.2 Interfaces.................................................... 1534
9.6.3 WLANdriverandfirmware ..................................... 1535
9.6.4 Thermaltool ................................................. 1536
9.6.5 Implementation ............................................... 1536
9.6.6 TMD-WLANinterface ......................................... 1539
9.7 Supportfor802.11v-2011DMS........................................... 1540 9.7.1 Limitations .................................................. 1541
9.7.2 Design ...................................................... 1542
9.8 TransmitpowercontrolperSSIDforcontrolframes .......................... 1543
9.9 ModifyTxchain-maskwithoutreconnectingclients .......................... 1544 9.9.1 Sampleconfigurationscenario ................................... 1545
9.9.2 Knownlimitations ............................................. 1548
9.10 Disable buffering of multicast frames for OL mode stations in power-save mode . . . . 1548
9.11 Support for the same Tx power-out in dBm with antenna across all chains . . . . . . . . . 1550
9.12 TargetclockfrequencyreductionforIPQ4019 ............................... 1553
9.12.1 UCIcommands ............................................... 1553
9.12.2 Limitations .................................................. 1554
9.12.3 Sample configuration scenario for power-saving with Green AP . . . . . . . . 1554
9.13 Support for the same Tx power-out in dBm with antenna across all chains on IPQ4019 . . . 1555
9.14 GreenAPpower-savinginconnected-idlestatus ............................. 1556
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
52
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
80-YA728-6 Rev. YV
9.14.1 Featuredesignforpower-savingofidleclients ...................... 1556
9.14.2 Configurationusingiwprivcommand ............................. 1556
9.15 Per-unit one-point calibration for improved CLPC accuracy for IPQ807xA and IPQ817x
chipsets 1557
9.15.1 Featuredesign ................................................ 1557 9.15.2 BDFchanges................................................. 1557
9.16 SURxpilotEVMonQCN90xx/QCN602xplatforms ......................... 1558
9.17 Per-unit calibration for improved CLPC accuracy on QCN90xx/QCN602x platforms 1558
9.18 QCN90xx/QCN602x combined TxLO TxIQ RxIQ imbalance calibration and Rx DC offset calibration 1560
9.19 eDPD for IPQ60xx with QCN5X21/QCN5X22/QCN5X52 in 2.4 GHz iPA . . . . . . . . 1561
9.20 DPDcalibrationinFTMmodeforQCN90xx/QCN602xchipsets ................ 1562
9.21 48MHz XTAL support for IPQ60xx and QCN5X21/QCN5X22/QCN5X52 . . . . . . . . 1563
9.22 Staticchainmaskstoreducepower ........................................ 1563
9.23 Dynamic SMPS support for multiple spatial streams for DL OFDMA and DL MU-MIMO
1563
9.24 AdvancedGreenAPmode............................................... 1565
10 RegulatorycomplianceofWLANAPs................................... 1568
10.1 Regulatorycompliance ................................................. 1568
10.1.1 UMACchannellistpreparationfromRegDB ....................... 1568
10.1.2 HOSTcodebase............................................... 1569
10.1.3 SoftwareAPIs ................................................ 1570
10.1.4 Hostregdbparsing ............................................ 1570
10.2 Offloadedregulatoryrulestofirmware ..................................... 1573
10.3 PreserveregulatorysettingsafterHLOSreplacement .......................... 1578
10.4 Regulatory offload, 802.11d offload, and regulatory componentization . . . . . . . . . . . . 1578
10.4.1 Datastructuresfornewregdb .................................... 1587
10.4.2 RegulatoryoffloadWMIinterface ................................ 1588
10.4.3 RegulatorycomponentdatastructuresandAPIs ..................... 1589
10.4.4 Regulatoryoffloadnewinitsequencechanges ....................... 1593
10.4.5 Dynamiccountrycodeprogrammingchanges ....................... 1594
10.4.6 Handlechangestocurrentchannellist ............................. 1595
10.4.7 802.11doffloadWMIinterfacechanges ............................ 1595
10.4.8 Host802.11doffloadchanges .................................... 1596
10.4.9 Firmware802.11dandOffloadChanges ........................... 1599
10.4.10 RegulatoryfirmwaredatastructuresaddedtoBDF ................... 1601
10.5 MU-EDCAoverview ................................................... 1601
10.5.1 High-levelMU-EDCAdesign ................................... 1602
10.5.2 StructureoftheMU-EDCAIE ................................... 1602
10.5.3 DefaultMU-EDCAparameters .................................. 1604
10.5.4 Newdatastructures ............................................ 1604
10.5.5 Newfunctions ................................................ 1605
10.5.6 MU-EDCAcommands ......................................... 1606
Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 53
MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide
Contents
10.6 Wi-FiLTE-Uoperation .................................................
10.6.1 LTE-Urequirements ...........................................
10.6.2 WLANdriverdesign...........................................
10.6.3 LTE-Uconfiguration ...........................................
10.6.4 Displaystatisticsandpacketlogs .................................
10.6.5 Knownlimitations.............................................
10.7 TxOPsof10msforbesteffortaccesscategory ...............................
10.7.1 Configuredoublebackofffor10msTxOPs ......................... 10.7.2 Sampleconfigurationscenario ...................................
10.8 ETSIcomplianceforCOTandCATonQCA9980andQCA9880 ................
10.8.1 CALandCOTconsiderations....................................
10.8.2 Designmethodology ...........................................
10.8.3 Testmethods .................................................
10.8.4 Limitations ..................................................
10.9 5.9GHzfrequencyband ................................................ 10.9.1 Designoverview ..............................................
10.9.2 Verifythe5.9GHzband ........................................
10.10 ETSI5GHzrulesinEurope(ETSIEN301893) .............................
10.11 Support for 5.8 GHz channels for U.K. and ETSI 302 502 radar patterns . . . . . . . . . .
10.11.1 Additional country codes for regulatory domains . . . . . . . . . . . . . . . . . . . . . 10.12 RegulatorydomainandCTLfailsafebehavior ............................... 10.12.1 Failsafedesignoverview ........................................ 10.12.2 FirmwareimplementationofCTLfailsafebehavior ..................
10.13 Enhancements to country codes and regulatory domains in QCA_Networking_ 2019.SPF.11.0 release and later 1661
10.14 Tx burst length limit for Japan regulatory domain on IPQ807x platforms . . . . . . . . . .
10.15 Enhancements to country codes and regulatory domains in QCA_Networking_
2020.SPF.11.1 release and later 1662
10.16 MU-EDCAdynamicadaptationandmixedmodeenhancements .................
10.17 Enhancements to regulatory domain in QCA_Networking_2020.SPF.11.2 release and 1668
10.18 Collision reduction and TxOP protection trigger in mesh networks . . . . . . . . . . . . . . .
10.19 RegulatorydomainchangesforIndonesiacountrycode ........................
11 Memoryandperformance............................................... 11.1 ART2calibration ...................................................... 11.1.1 Theoryofoperation............................................
11.2 Interruptmitigationormoderation.........................................
11.2.1 Interrupts ....................................................
11.2.2 Mitigation:Asimpleimplementation ..............................
11.2.3 Mitigation:Unintendedconsequence ..............................
11.2.4 MACmitigationsupport ........................................
11.3 SIFSburst............................................................
11.3.1 Theoryofoperation............................................
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 1607
 1608
 1610
 1621
 1625
 1631
 1631
 1632
 1633
 1637
 1637
 1639
 1639
 1639
 1639
 1640
 1644
 1646
 1656
 1657
 1658
 1658
 1660
1662
1664 later
1669 1671
 1672
 1672
 1672
 1676
 1676
 1677
 1677
 1677
 1678
 1678
54
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
11.3.2 Implementation ............................................... 1679
11.4 Adaptivenoiseimmunity(ANI) .......................................... 1679
11.4.1 Theoryofoperation............................................ 1679
11.4.2 Implementation ............................................... 1680
11.5 Airtimefairness ....................................................... 1684
11.5.1 ATFrequirement ............................................ 1684
11.5.2 ATFdesignforoffloadarchitecture ............................... 1685
11.5.3 ATFdesignfornon-offloadarchitecture ............................ 1690
11.5.4 ATF—OBSSinterference ...................................... 1697
11.5.5 ATF—Txbufferdistribution .................................... 1698
11.5.6 ATF—Maximumclientssupportinnon-offload..................... 1698
11.5.7 ATF—SSIDgroupingsupportinnon-offload ....................... 1698
11.5.8 ConfigureSSIDgroupingforATF ................................ 1698
11.5.9 ATF – Dynamic enable/disable feature for non-offload architecture . . . . . . 1699
11.5.10 ATF–Guaranteedthroughputorbandwidthfairness .................. 1699
11.5.11 ATF- per SSID scheduling policy configuration in non-offload . . . . . . . . . . 1700
11.6 AirtimeconfigurationGUI............................................... 1702
11.7 ATFeventlogging ..................................................... 1707
11.8 ATFfair-schedulingbasedonWMMaccessclasses ........................... 1708
11.9 ATFbandwidthfairnessorminimumguaranteedthroughput .................... 1709
11.10 ATFstrict-schedulingperSSIDorvirtualdeviceforQCA9880 .................. 1710
11.11 ATF strict scheduling per SSID or virtual device for QCA9984, IPQ4019, and QCA9886 . 1711
11.12 ATFsupportforMU-MIMO ............................................. 1712
11.13 ATFhierarchydistribution ............................................... 1713 11.13.1 GuidelinesforATFhierarchydistribution .......................... 1714
11.14 Scatter/gatherDMA .................................................... 1715
11.14.1 Implementation ............................................... 1715 11.14.2 Configuration ................................................ 1716
11.15 Co-ordinatedATFbetweenrootAPandrepeater ............................. 1716
11.16 Peerflowcontroldatapath .............................................. 1716 11.16.1 Packetflow .................................................. 1717
11.17 Content-awarerouting .................................................. 1717
11.18 OverrideMU-MIMOcapabilitybasedonvendorOUI ......................... 1717
11.19 QCache.............................................................. 1723
11.20 Firmwarecodesignandfirmwareauthenticationathost ....................... 1724
11.21 WLANLEDimplementation ............................................. 1730
11.21.1 OffloadpathimplementationforWLANLEDcontrol................. 1730
11.21.2 Wi-Fi LED support on IPQ60xx/IPQ50xx/IPQ807x/IPQ807xA/IPQ817x chipsets 1731
11.22 Pre-allocationoftherequiredruntimememory ............................... 1731
11.22.1 Memorypooldatastructures..................................... 1731 11.22.2 Initializationofmemorypools ................................... 1732
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 55 MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
  2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide
Contents
80-YA728-6 Rev. YV
56
11.22.3 Runtimeallocationandfreeinterfaces ............................. 11.23 Wi-Fireload .......................................................... 11.23.1 Avoidingmodulereloadduringwifiup/down ....................... 11.23.2 Reasonsbehindthischange ..................................... 11.23.3 Codechanges ................................................ 11.23.4 Reloadingthemoduleswithnewmoduleparameters ................. 11.24 MU-MIMO...........................................................
11.24.1 MU-MIMOperVAPstatistics ...................................
11.24.2 Txsoundingstatistics ..........................................
11.24.3 TxMUstatistics ..............................................
11.24.4 TxSelfgenstatistics ...........................................
11.24.5 TxtransmittedMUpacketcountperpeer ..........................
11.24.6 UserpositionsindifferentMUgroupsforaparticularAID.............
11.24.7 Sampletestscenario ...........................................
11.24.8 MU-MIMOdatapathenhancementsoverview ......................
11.24.9 EnhancedMU-MIMOdebuggingstatistics .........................
11.24.10 Enhanced MU-MIMO for scoring metrics and MU grouping . . . . . . . . . . .
11.25 Latencyoptimization ...................................................
11.25.1 Problemstatement.............................................
11.25.2 Objectives ...................................................
11.25.3 Design ......................................................
11.26 MU-MIMOgroupIDmanagement ........................................ 11.26.1 802.11acGIDmanagementscheme ............................... 11.27 FILScapability........................................................ 11.27.1 Wi-FidriverenhancementsforFILSsupport ........................ 11.27.2 HostapdenhancementsforFILSsupport ........................... 11.28 FILSDiscoveryframes .................................................
11.28.1 Enable/disableFILSDiscoveryFramesupport ......................
11.28.2 UCIcommandstoconfigureFILSDiscoveryFrames .................
11.28.3 WMIcommandtoenableFDframes ..............................
11.28.4 SWFDAevent................................................
11.28.5 SendFDbufferframetothefirmware .............................
11.29 Supportfordynamicallyenablinganddisablingburst ......................... 11.30 ATFgrouping,scheduling,andWMMACATFforoffloadchipsets ..............
11.30.1 HierarchicalATFmodel ........................................
11.30.2 Grouping ....................................................
11.30.3 Scheduling...................................................
11.30.4 Restrictedfairscheduling .......................................
11.30.5 Design ......................................................
11.30.6 Freetokencollectionanddistributionalgorithm .....................
11.30.7 WMMACATFforgroups ......................................
11.30.8 ATFstructures ................................................
11.30.9 List of WMI commands and definitions . . . . . . . . . . . . . . . . . . . . . . . . . . . .
Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets
1732
1733
1733
1733
1733
1734
1735
1736
1736
1737
1737
1738
1738
1739
1749
1752
1754
1755
1756
1756
1757
1759
1759
1761
1761
1762
1762
1763
1764
1765
1765
1765
1766
1766
1767
1768
1768
1769
1769
1770
1772
1775
1775
MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide
Contents
80-YA728-6 Rev. YV
11.30.10 11.30.11 11.30.12
WMIsequencefromhostwithgroupingenabled ..................... 1777 WMIcommandinvokeduponuseractivity ......................... 1777 ExamplesforATFrestrictedfairschedulingandforACATF ........... 1778
11.31 Accesscategory-basedATFfornon-offloadchipsets .......................... 1778
11.31.1 SampleAC-basedATFconfiguration .............................. 1779
11.31.2 AC-basedATFhigh-leveldesign ................................. 1782
11.31.3 AC-basedATCcommands ...................................... 1786
11.31.4 SSID-basedATFconfiguration ................................... 1787
11.31.5 ATFhosttablechanges ......................................... 1788
11.31.6 Limitations .................................................. 1789
11.32 ATFfairschedulingwithidleclients ....................................... 1790
11.32.1 WorkflowofATFfairschedulingforidleclients ..................... 1791
11.32.2 Known limitations and exceptions . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 1795
11.32.3 Sampleconfigurationscenario ................................... 1795
11.32.4 ATF fair scheduling with idle clients—Host and WMI commands . . . . . . . 1797
11.32.5 OrderofWMIcommandsfromhostwhenATFmodeisenabled ........ 1798
11.32.6 DefinitionofeachWMIcommandandassociatedfields ............... 1799
11.32.7 Sampleconfigurationscenarios .................................. 1802
11.33 MU-MIMO2x2enhancements ........................................... 1812
11.33.1 MU-MIMO 2x2: Scoring logic enhancement for more accurate overhead and
using rate drop down 1812
11.33.2 MU-MIMO2x2:NDPArateadaptation ............................ 1818
11.33.3 MU-MIMO2x2:CBFrateadaptationatclientside ................... 1819
11.33.4 MU-MIMO 2x2: Scheduler enhancements to improve MU gain . . . . . . . . . 1819
11.33.5 MU-MIMO 2x2: Sounding NC and NSS Distribution for MU2+1 . . . . . . . 1820
11.33.6 MU-MIMO2x2:Probeparameterstuning .......................... 1822
11.34 Computation of accurate RSSI on legacy 802.11ac Wave 2 platforms . . . . . . . . . . . . . 1822
11.35 PreserveATFconfigurationsacrossasystemreboot........................... 1823 11.35.1 UCIconfigurationsectionsforATF ............................... 1823
11.36 Estimatedthroughputforanewly-joiningSTA ............................... 1828
11.36.1 Firmwareimplementation ....................................... 1828
11.36.2 How firmware calculates the estimated airtime for the newly joining STA . 1830
11.36.3 Keydatastructuresinfirmware .................................. 1832
11.37 Toggling 4x4 and 8x8 MIMO mode on IPQ807x/IPQ807xA/IPQ817x . . . . . . . . . . . . 1834
11.38 Spur mitigation for IPQ807xA, IPQ817x, and IPQ60xx/IPQ50xx/QCN90xx/QCN602x + IPQ807xA/IPQ60xx/IPQ50xx, QCN61xx + IPQ50xx 1834
11.39 Dual sub-carrier modulation (DCM) for IPQ807xA, IPQ817x, and IPQ60xx/IPQ50xx/QCN90xx/QCN602x + IPQ807xA/IPQ60xx/IPQ50xx, QCN61xx + IPQ50xx 1837
11.40 SUmulti-destinationSIFSburstingfeature .................................. 1837 11.40.1 Scheduleralgorithm ........................................... 1838 11.40.2 Sequencecontrolinfrastructure .................................. 1838 11.40.3 Transmissionandcompletionpath ................................ 1838 11.40.4 Limitations .................................................. 1839
Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 57
MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide
Contents
11.41 Adaptive Noise Immunity in IPQ807x/IPQ807xA/IPQ817x and IPQ60xx/IPQ50xx/QCN90xx/QCN602x + IPQ807xA/IPQ60xx/IPQ50xx, QCN61xx + IPQ50xx 1839
11.41.1 ANI design in IPQ807x, IPQ807xA, IPQ817, and IPQ60xx/IPQ50xxx/QCN90xx/QCN602x/QCN61xx 1841
11.41.2 ConfigureANIsettings ......................................... 1842
11.42 Downlink MU-MIMO — 20, 40, and 80 MHz for IPQ817x and
IPQ60xx/QCN90xx/QCN602x + IPQ807xA/IPQ60xx platforms 1843
11.43 802.11ax HE SU TXBF for IPQ807x and IPQ60xx/IPQ50xx/QCN90xx/QCN602x + IPQ807xA/IPQ60xx/IPQ50xx, QCN61xx + IPQ50xx platforms 1843
11.44 TxBF HE — 3SS/4SS on IPQ807xA and 1SS/2SS IPQ817x and IPQ60xx/IPQ50xx/QCN90xx/QCN602x + IPQ807xA/IPQ60xx/IPQ50xx, QCN61xx + IPQ50xx platforms 1844
11.45 802.11ax MU sounding and steering sequence on IPQ807x and IPQ60xx/QCN90xx/QCN602x + IPQ807xA/IPQ60xx platforms 1844
11.46 DownlinkMUMIMO—160MHz......................................... 1845
11.47 Uplink MU-MIMO on IPQ807xA and IPQ60xx/QCN90xx/QCN602x +
IPQ807xA/IPQ60xx platforms 1846
11.48 Downlink OFDMA on IPQ807x, IPQ60xx, IPQ50xx, and QCN90xx/QCN602x +
IPQ807xA/IPQ60xx/IPQ50xx, QCN61xx + IPQ50xx platforms 1848
11.49 Uplink OFDMA on IPQ807x and IPQ60xx/IPQ50xx/QCN90xx/QCN602x + IPQ807xA/IPQ60xx/IPQ50xx, QCN61xx + IPQ50xx platforms 1849
11.50 Enhanced display of uplink OFDMA statistics for IPQ807x and IPQ60xx/IPQ50xx/QCN90xx/QCN602x + IPQ807xA/IPQ60xx/IPQ50xx, QCN61xx + IPQ50xx 1849
11.51 Memory profile enhancements for 512 MB for enterprise, 3-radio SBS solutions . . . . 1855
11.52 Single user HE MU DL-OFDMA Tx and HE TB UL-OFDMA Rx on IPQ60xx . . . . . 1855
11.53 Optimizingmulti-clientMUthroughputfor2x2configuration................... 1855
11.54 ATF grouping, scheduling, and WMM AC ATF for IPQ807x and later chipsets . . . . . 1856
11.54.1 WMMACATFforgroups ...................................... 1857
11.54.2 WeightcomputationwithWMMconfig ............................ 1857
11.54.3 WMMpercentagecomputationalgorithm .......................... 1858
11.54.4 Sample output of WMM percentage computation algorithm in various scenarios
1859
11.54.5 Schedulingwithimplicitandexplicitpeers ......................... 1860
11.55 Dynamicbandwidthfor160MHzsingleuserTxBF ........................... 1861
11.55.1 TLV operationinTxBFmodes ................................... 1862
11.55.2 160MHzTxBFTLVs .......................................... 1863
11.56 UL-MU-MIMO and UL OFDMA rate adaptation improvement on IPQ807xA platforms . . 1884
11.56.1 Firmwareconfigurationcommands ............................... 1885
11.57 PartialsoundingfeatureforHEMU-MIMO ................................. 1885
11.58 SpurmitigationonQCN90xx/QCN602xplatforms ........................... 1886
11.59 STAsupportonQCN90xx/QCN602x ...................................... 1888
11.60 Standalonesoundingsequence............................................ 1888
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 58 MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide
Contents
11.61 FILSandFTsupportforOCEplatforms .................................... 1892 11.61.1 DesignoverviewofFILS+FT ................................... 1894 11.61.2 SamplewirelessconfigurationforFT+FILS ........................ 1896
11.62 DebuggingenhancementsforULMU-MIMO ............................... 1898
11.62.1 AddpacketlogeventsforUL-MUMIMOscheduler .................. 1899
11.62.2 Addtraffictype,accesscategoryforMUMIMOevents................ 1899
11.62.3 Add number of UL-MUMIMO schedules posted to lower data path . . . . . . 1899
11.62.4 Add counter for all Tx modes (DL/UL-MUMIMO/OFDMA). . . . . . . . . . . 1899
11.62.5 Sampleoutputwithenhanceddebuginformation..................... 1899
11.63 BurstingsupportforULOFDMAwithgroupofusers ......................... 1902 11.63.1 ConfigureUFOFDMASIFSbursting ............................. 1904
11.64 DelayedacknowledgmenttoimproveRxsensitivity .......................... 1905
11.65 Mixed clients/mixed ACs/interference performance improvements . . . . . . . . . . . . . . . 1905
11.66 OFDMAperformancetestingtuningandrecipeenhancements .................. 1906
11.66.1 Configurebasictriggerprotectionmechanism ....................... 1907 11.66.2 FWdebugandstatisticscommands ............................... 1908
11.67 EnablecollectionofATFstatistics......................................... 1910
11.67.1 DesignoverviewofATFstatisticscollection ........................ 1910
11.67.2 ATFstatisticsperiodicdisplayformat ............................. 1912
11.67.3 ATFstatisticsAPIs ............................................ 1915
11.67.4 ATFstatisticscommands ....................................... 1917
11.68 Firmwarememoryoptimization........................................... 1918
11.69 HTT-enhancedPHYdebugstatistics ....................................... 1918
11.70 Memory 1922
optimization for monitor destination buffers on IPQ807x and later data paths ...
11.70.1 Init/deinit path for memory optimization of monitor buffer . . . . . . . . . . . . . 1924
11.70.2 MPDUreap .................................................. 1926
11.70.3 MPDUrestitch ............................................... 1929
11.70.4 MPDUdeliverandupdatePFtag ................................. 1931
11.70.5 Behavior changes caused by the memory optimization of destination buffers . . .
11.71 Memory
1932
optimization for monitor status buffers on IPQ807x and later data paths . . . . 1933
12 IEEE802.11features .................................................... 1935 12.1 802.11ac(veryhighthroughput)features ................................... 1935
12.1.1 Initialization ................................................. 1936
12.1.2 Configuration ................................................ 1937
12.1.3 Operation.................................................... 1937
12.1.4 APmode .................................................... 1938
12.1.5 STAmode ................................................... 1938
12.2 160/80+80MHzoperation ............................................... 1939 12.2.1 Allowedchannels ............................................. 1940 12.2.2 NSSnegotiationin160/80+80MHzmodes ......................... 1948 12.2.3 Revised160/80+80MHzoperationsignaling ....................... 1952
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 59 MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
12.3 802.11nfeatures ....................................................... 1954
12.3.1 A-MPDUaggregation(peerfeaturenegotiation) ..................... 1954
12.3.2 Datatransmitaggregation ....................................... 1955
12.3.3 Datareceiveaggregation........................................ 1957
12.3.4 A-MSDUaggregation .......................................... 1957
12.3.5 SpecifyMSDUQdepthparameters................................ 1958
12.4 802.11wprotectedmanagementframes(PMF) ............................... 1958 12.4.1 OverviewofPMF ............................................. 1958 12.4.2 ImplementationofPMF ........................................ 1959 12.4.3 DriverfilesforPMF ........................................... 1959 12.4.4 hostapdfiles ................................................. 1960
12.5 8-chainoperation ...................................................... 1962
12.6 802.11axprotocoloverview .............................................. 1963
12.6.1 MU-MIMO .................................................. 1964
12.6.2 DLMU-MIMO ............................................... 1965
12.6.3 ULMU-MIMO ............................................... 1965
12.6.4 OFDM-FDMA(OFDMA) ...................................... 1966
12.6.5 11axOFDMAresourceunits .................................... 1967
12.6.6 ULOFDMA ................................................. 1968
12.6.7 DLOFDMA ................................................. 1969
12.6.8 OFDMAvsMU-MIMO ........................................ 1970
12.6.9 DLOFDMAMUgainexample .................................. 1970
12.6.10 AdaptiveCCA................................................ 1971
12.6.11 Longersymbol ............................................... 1973
12.6.12 11axPHYstructure:Frequency-timestructure....................... 1974
12.7 Configurecustomaggregationandratedrop-down ............................ 1974
12.8 Supportfor802.11axROMI ............................................. 1975 12.8.1 HTControlfield .............................................. 1976 12.8.2 A-Control ................................................... 1977 12.8.3 Sampleconfigurationscenario ................................... 1979
12.9 ConfigureAMPDUperVAPforOLmodes ................................. 1980 12.9.1 AMPDUperVAP ............................................. 1981
12.10 ConfigureAMSDUperVAPforOLmodes ................................. 1982
12.11 UsingSAquerytimeoutforPMF ......................................... 1983 12.11.1 Protectedmanagementframes(PMF)parameters .................... 1984 12.11.2 UCIcommandtoconfigureSAquerytimeoutforPMF ............... 1984
12.12 Retrieveanddisplayradarchanneldetails ................................... 1985 12.12.1 Sampleconfigurationscenario ................................... 1985
13 QoSoperations ......................................................... 1987 13.1 Accesscontrollistsfunctionality .......................................... 1987 13.1.1 Implementation ............................................... 1987 13.1.2 Configuration ................................................ 1988
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 60 MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide
Contents
13.2 iQue(IntelligentQoSforUserExperience) .................................
13.2.1 MulticastEnhancement(ME) ....................................
13.2.2 HeadoftheLineBlockingRemoval(HBR).........................
13.3 Support for SFE on IPQ8064 platforms—Coexistence between offload engines . . . . .
13.4 RejectclientswithlowSNR .............................................
13.4.1 Configuration ................................................
13.4.2 High-leveldesign .............................................
13.5 Configure the forwarding of ADDTS/DELTS and related action frames . . . . . . . . . . .
13.6 HNATonQCA9531,QCA9558,andQCA9563chipsets .......................
13.6.1 ARPpacketprocess ...........................................
13.6.2 StaticNATimplementation......................................
13.6.3 NAPTimplementation .........................................
13.6.4 SampleconfigurationscenarioofstaticanddynamicNAT .............
13.7 IPQ807x/IPQ807xA/IPQ817x and IPQ60xx/IPQ50xx/QCN90xx/QCN602x + IPQ807xA/IPQ60xx/IPQ50xx, QCN61xx + IPQ50xx QoS overview 2008
13.7.1 Linuxsk_buff ................................................
13.7.2 NSSdriver(qca-nss-drv) .......................................
13.7.3 iptables .....................................................
13.7.4 EgressQoS ..................................................
13.7.5 IngressQoS..................................................
13.8 ConversionofmulticastpacketstounicastpacketsforVoW ....................
14 Beaconsandframestransmission ......................................
14.1 Transmitbeamforming(TxBF) ...........................................
14.1.1 ExplicitfeedbackTxBF ........................................
14.1.2 Hardware definitions for beamforming . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
14.1.3 Beamformingsoftwareflow .....................................
14.1.4 EnableTxBF .................................................
14.1.5 ChangeCVupdateperiod .......................................
14.2 SUTxbeamforming....................................................
14.3 SoftwareRetry(SWR) ..................................................
14.3.1 Theoryofoperation............................................
14.3.2 Implementation ...............................................
14.3.3 Configuration ................................................
14.4 Burstedbeaconing .....................................................
14.5 WakeonWirelessAPAssist ............................................. 14.5.1 High-leveldesign ............................................. 14.5.2 WoWpacketformatonWireshark ................................
14.6 DynamicTransmitChainmaskSelection(DTCS) .............................
14.6.1 Theoryofoperation............................................
14.6.2 Implementation ...............................................
14.6.3 Configuration ................................................
14.7 QuickSTAKickout(QSK) ..............................................
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
1988
1988
1993
1994
1997
1997
1997
1997
1998
2000
2001
2002
2007
2009
2009
2009
2010
2027
2030
2032
2032
2033
2037
2046
2049
2050
2050
2051
2051
2054
2058
2058
2060
2060
2061
2062
2062
2063
2063
2063
61
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide
Contents
80-YA728-6 Rev. YV
62
14.7.1 Theoryofoperation............................................
14.7.2 Implementation ...............................................
14.7.3 Configuration ................................................
14.8 Supportforradiotapheader .............................................. 14.8.1 Radiotap changes for PCI device ID and antenna DB in sniffer feedback . . 14.9 OCEoverview ........................................................
14.9.1 MBO-OCE IE, Optimized Connectivity Experience Attributes, and Frame Formats 2081
14.9.2 Configurationcommands .......................................
14.10 HotSpot2.0 ..........................................................
14.10.1 BeaconorproberesponseIEprocessing ...........................
14.10.2 Proberequestprocessing........................................
14.10.3 Actionframeprocessing ........................................
14.10.4 ProxyARP ..................................................
14.10.5 DGAFdisable ................................................
14.10.6 L2TIF ......................................................
14.11 HiddenSSIDsupportinstrictpassivescan .................................. 14.12 MultibandOperation(MBO)overview ..................................... 14.13 Wi-FiAllianceMBOfunctions ...........................................
14.13.1 Multibandoperationarchitecture .................................
14.13.2 Multiband operation topology . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
14.13.3 Multibandoperationprotocol ....................................
14.13.4 MultibandOperationIEAttributesandFrameFormats ................
14.13.5 CommandstoconfigureMBO ...................................
14.14 HostTxflowcontrol ................................................... 14.15 DescriptorconfigurationforFW .......................................... 14.16 Dynamicbeacon....................................................... 14.17 Enhanceddynamicbeacons .............................................. 14.18 BeaconratecontrolperSSIDforoffloadmode............................... 14.19 TX99mode ..........................................................
14.19.1 TX99for11nradio ............................................
14.19.2 TX99ioctloptions ............................................
14.19.3 TX99configurationcommands ..................................
14.19.4 Tx99for802.11acradio ........................................
14.19.5 athtestcmdTxRateTable .......................................
14.19.6 Testingwithtx99toolandathtestcmd ..............................
14.19.7 athtestcmdper-chainRSSIsupportforQCA9980radios ...............
14.20 RawmodeTx/Rx ......................................................
14.20.1 IntroductiontorawmodeTx/Rx..................................
14.20.2 ScopeofrawmodeTx/Rx ......................................
14.20.3 DesignofrawmodeTx/Rx ......................................
14.20.4 Rawmodesimulationparameters .................................
14.20.5 Rawmode—firmwareconfiguration ..............................
Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets
2064
2064
2064
2064
2068
2069
2087
2090
2090
2091
2091
2092
2092
2092
2094
2096
2100
2101
2102
2105
2112
2124
2132
2132
2133
2136
2139
2140
2140
2141
2142
2144
2149
2153
2155
2157
2157
2158
2162
2165
2166
MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide
Contents
14.21 Off-channelTxandRx..................................................
14.21.1 Off-channelTx/Rxcomponent ...................................
14.21.2 High-leveldesign .............................................
14.21.3 Low-leveldesign..............................................
14.22 CSAwithbeaconoffload ................................................ 14.22.1 Architecture.................................................. 14.23 Beaconoffload ........................................................
14.23.1 Hostdriverdesign .............................................
14.23.2 Implementation ...............................................
14.23.3 SWBAandTBTThandling .....................................
14.24 UCIcommandstoconfigureRADIUSparametersforretries .................... 14.25 WAPIwith16VAPclients ............................................... 14.25.1 Sampleconfigurationscenarios .................................. 14.26 Configurerandomnumbergenerationmode .................................
14.27 Support for a rule to discard management frames below a configured RSSI threshold 14.28 Off-channelTx/RxwithoutactiveWLAN .................................. 14.28.1 Additionalparametersforoff-channelscan ......................... 14.29 ConfigureTxAcktimeoutvalue ..........................................
14.29.1 ConfigureandverifytheTxAcktimeoutvalue ......................
14.29.2 Verify that ACK timeout value is not modified after channel change . . . . .
14.29.3 Verifythebring-upofAP/STA VAPinopenmode(5GHz) ............
14.29.4 Verifythebring-upofAP/STA VAPinopenmode(2.4GHz) ...........
14.30 TxBF+CVmanagement ................................................
14.30.1 CV/TxBFmanagementflow .....................................
14.30.2 CBFframeuploading ..........................................
14.30.3 PHY/Wi-FiIPCinterface .......................................
14.30.4 CVbuffermanagement .........................................
14.30.5 Legacymodecompliance .......................................
14.31 Beamforming:Enable/disableper-peersoundinginterval....................... 14.32 802.11axfirmwareschedulerAPIsandstatisticsperpeer....................... 14.33 Support offload-based radios to connect to Wi-Fi hotspot of phones . . . . . . . . . . . . . . 14.34 QCNbroadcastproberesponse ...........................................
14.34.1 Requirements addressed with QCN broadcast probe response . . . . . . . . . . .
14.34.2 GuidelinesforQCNbroadcastproberesponse .......................
14.34.3 DesignchangesforQCNbroadcastproberesponse ...................
14.34.4 ConfigureQCNbroadcastproberesponsecapability ..................
14.34.5 Sampleconfigurationscenario ...................................
14.35 Customizedneighborreport .............................................. 14.36 Addressing client steering challenges in WLANs using MBO and OCE . . . . . . . . . . . 14.37 Mirror Tx packets from AP VAP to a monitor VAP in non-offload radios . . . . . . . . . . 14.38 TxdatapacketcapturesinOLmode ....................................... 14.39 Transmission of MBO Reason Code attribute in BTM Request frames . . . . . . . . . . . . 14.39.1 ImplementationofMBOReasonCode.............................
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
2168
2169
2169
2170
2171
2171
2177
2177
2180
2180
2181
2183
2185
2193
2193
2194
2195
2196
2196
2197
2198
2198
2198
2198
2202
2202
2202
2205
2205
2206
2206
2207
2207
2208
2208
2209
2210
2210
2212
2213
2214
2215
2217
63
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
14.40 ConfigureTxAcktimeoutvalue .......................................... 2220
14.40.1 ConfigureandverifytheTxAcktimeoutvalue ...................... 2221
14.40.2 Verify that ACK timeout value is not modified after channel change . . . . . 2222
14.41 TR-181dataelementsforcarriernetworks .................................. 2223 14.42 IdleclientdetectionforTxpath ........................................... 2223 14.42.1 Designoverview .............................................. 2224 14.43 Display802.11vBTM-capablestations ..................................... 2225
14.43.1 Flow diagram for retrieving the 11v BTM supported stations . . . . . . . . . . . 2226
14.43.2 ChangesinWi-Fidriver ........................................ 2226
14.43.3 Sampleconfigurationscenarios .................................. 2226
14.44 EnableHK09,AC01,andAC02RDPs ..................................... 2229 14.45 Cancelbroadcastproberesponseifabeaconispresent ........................ 2231 14.46 ConfigureAPTWT .................................................... 2232
14.46.1 Designoverview .............................................. 2234
14.46.2 Configurations................................................ 2244
14.46.3 TWTstatemachine ............................................ 2245
14.47 WFA Vantage2complianceforIPQ807x/IPQ807xA/IPQ817x .................. 2246 14.48 SupportforEAPOLminimumrateWMIresourceconfiguration ................. 2246 14.49 SupportfortransmissionofGPR .......................................... 2247
14.49.1 Framestructureandformation ................................... 2248
14.49.2 GPRtimerstatediagram ........................................ 2250
14.49.3 GPRflowdiagram ............................................ 2251
14.50 Heavyclipsettingsfor2.4GHzand5GHzonIPQ807xandIPQ807xA ........... 2251 14.50.1 IPQ807x .................................................... 2252 14.50.2 IPQ807xA ................................................... 2252 14.51 EnableIPQ8173andIPQ8174RDPs....................................... 2252 14.52 SmartAPTWT–Congestion-basedSTAbinning ............................ 2254 14.52.1 Softwaredesign ............................................... 2254 14.53 Off-channelRxfor20,40,80,and160MHzchannels ......................... 2258
14.53.1 Configureoff-channelRx ...................................... 2259
14.53.2 Sampleconfigurationcommandsforoff-channelRx .................. 2260
14.54 SingleBDFforSBSandDBS ............................................ 2260 14.55 Per-packethardwaretimestampgenerationafterTx ........................... 2261 14.56 SBSmodeforIPQ6028CP02.3RDP ...................................... 2261
14.56.1 BDFdetails .................................................. 2262
14.56.2 SampleconfigurationofSBSandDBSsettings ...................... 2263
14.57 802.11axTWTenhancements ............................................ 2266 14.57.1 Designoverviewof802.11axTWTenhancements ................... 2266 14.57.2 SampleAPconfiguration ....................................... 2267 14.58 QCN90xx/QCN602x calibration database for 160 MHz, 165 MHz, and 6 GHz . . . . . 2268 14.59 Supportforbeaconprotection ............................................ 2269
14.59.1 Componentsforbeaconprotection ................................ 2272
14.59.2 Interaction of host and target messages for beacon protection . . . . . . . . . . . 2273
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 64 MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide
Contents
14.59.3 Sampleconfigurationsofbeaconprotection......................... 2273
15 Channelselection....................................................... 2275
15.1 Channelwidthmanagement(CWM20/40) .................................. 2275
15.1.1 TheoryofoperationofCWM20/40 ............................... 2275
15.1.2 ImplementationofCWM20/40 .................................. 2276
15.1.3 APIsofCWM20/40 ........................................... 2279
15.1.4 ConfigurationofCWM20/40 .................................... 2280
15.1.5 Offloadimplementation ........................................ 2280
15.2 Dynamicfrequencyselection(DFS) ....................................... 2280
15.2.1 Terminology ................................................. 2281
15.2.2 TheoryofoperationofDFS ..................................... 2281
15.2.3 ImplementationofDFS......................................... 2282
15.2.4 Configuration ................................................ 2299
15.2.5 CLIcommands ............................................... 2299
15.2.6 Troubleshooting .............................................. 2300
15.3 ZerowaitforDFSchannels .............................................. 2300
15.3.1 Termsandacronyms ........................................... 2303 15.3.2 ZeroCACDFSevents ......................................... 2303
15.4 ETSIpre-CAChostdriverandfirmwareenhancements ........................ 2309
15.5 EACSPLUS:ACS/OBSS ............................................... 2316
15.5.1 Requirements ................................................ 2317
15.5.2 Terminology ................................................. 2317
15.5.3 EACS_PLUSvs.EACSmajormetriccorrection ..................... 2317
15.5.4 EACSplusalgorithmchanges ................................... 2321
15.5.5 BackgroundACS/OBSSscan ................................... 2324
15.5.6 OBSScheck ................................................. 2324
15.6 Intelligentchannelmanager(ICM) ........................................ 2326
15.6.1 Design ...................................................... 2327
15.6.2 ICMchannelselectionlogic ..................................... 2330
15.6.3 Interface with dynamic channel selection . . . . . . . . . . . . . . . . . . . . . . . . . . . 2339
15.6.4 ICMwithcfg80211andWEXTmode ............................. 2339
15.7 UMACautochannelselection(scanning) ................................... 2341
15.7.1 Sourceofinterference .......................................... 2341
15.7.2 Selectionofchannels .......................................... 2341
15.7.3 Configuration ................................................ 2342
15.7.4 Dynamicchannelselection(DCS) ................................ 2342
15.7.5 ChannelLoadingandChannelHopping ............................ 2342
15.7.6 ChannelBlockList ............................................ 2346
15.8 Non-intrusivechannelselection ........................................... 2347
15.9 80MHzscan ......................................................... 2347
15.10 Dynamic channel selection—Interference mitigation (DCS-IM) for 802.11n and 802.11a . 2349
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
65
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide
Contents
15.10.1 Implementation ...............................................
15.10.2 Configuration ................................................
15.11 ModifychannelwidthinCSAfor5GHz ...................................
15.12 Enhanced channel switch and channel scan API . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
15.12.1 User space application and kernel space driver communication mechanism
15.12.2 NewIOCTLCommandsimplementedbyWLANdriver ...............
15.12.3 Netlink broadcast event notification sent by WLAN driver . . . . . . . . . . . . .
15.12.4 Limitations ..................................................
15.13 SendchannelstatisticseverysecondforDCSusingeventlogs ..................
15.14 Channelblocking .....................................................
15.14.1 Guidelines ...................................................
15.14.2 Specifytheblocklist...........................................
15.14.3 Specifytheblockingmode ......................................
15.14.4 Blocklist ...................................................
15.15 IPQ807x:HK0612-chainQCN5024boardforSBS ........................... 15.15.1 Designoverview .............................................. 15.15.2 FW–HALPHY .............................................. 15.15.3 Wi-Fihost ................................................... 15.15.4 WMIchanges ................................................ 15.15.5 ComputationofmaximumNSS ..................................
15.16 ChannelchangeandCSAsupportforcfg80211 .............................. 15.16.1 High-leveldesign .............................................
15.17 BSScolorannouncement ............................................... 15.17.1 High-leveldesign ............................................. 15.17.2 Sampleconfigurationscenario ................................... 15.17.3 Knownissues ................................................
15.18 EnhancedBSScolorchangeannouncement .................................
15.18.1 APrequirement ...............................................
15.18.2 STArequirement ..............................................
15.18.3 Hostarchitecture ..............................................
15.18.4 HostarchitectureforSTA .......................................
15.18.5 HostarchitectureforAP .......................................
15.18.6 WMIcommandsforBSScolorcollisionmitigation ..................
15.19 Inclusion of channel or band capability preference in STA association requests . . . . .
15.20 Transmission of QCN IE in beacons, probe responses, and association responses . . . .
15.21 Cloud-basedchannelchange .............................................
15.21.1 Guidelines for cloud-based channel change functionality . . . . . . . . . . . . . .
15.21.2 FlowdiagramofrepeaterAPbehavior .............................
15.21.3 APVAPbehaviorduringcloud-basedchannelchange.................
15.21.4 STA VAPbehaviorduringcloud-basedchannelchange ...............
15.21.5 Limitations with cloud-based channel change . . . . . . . . . . . . . . . . . . . . . . .
15.21.6 Sampleconfigurationscenarios ..................................
15.22 Channel-rankinginformationinACSreports ................................
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
2350
2353
2354
2355
2355
2356
2360
2361
2361
2362
2363
2363
2363
2364
2366
2367
2367
2368
2369
2384
2385
2385
2387
2387
2389
2390
2391
2391
2392
2393
2395
2396
2398
2399
2400
2404
2404
2405
2406
2407
2407
2407
2410
66
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
15.22.1 Methodofcalculationofchannelscore ............................ 2410 15.22.2 ConfigureanddisplayACSchannel-ranking ........................ 2411 15.22.3 Limitations .................................................. 2413
15.23 Supportforchecking802.11hcapability .................................... 2414 15.24 ScanningRSSIofNACs ................................................ 2414 15.25 Channelblocking ..................................................... 2417
15.25.1 Guidelines ................................................... 2418
15.25.2 Specifytheblocklist........................................... 2418
15.25.3 Specifytheblockingmode ...................................... 2419
15.25.4 Blocklist .................................................... 2419
15.26 Pre-clearedDFSlist .................................................... 2422 15.26.1 Zero-waitinETSIduringCAC .................................. 2422 15.26.2 Pre-clearedDFSduringchanelchange ............................ 2423 15.26.3 Pre-clearedDFSduringradardetection ............................ 2423
15.27 ConfigureallowedchannelsandACS-allowedchannels ....................... 2423 15.27.1 Guidelines ................................................... 2424 15.27.2 Limitations .................................................. 2425
15.28 Enhanced DFS support for tri-radio range extender in ETSI 80 MHz channels . . . . . . 2426
15.28.1 Design ...................................................... 2427
15.28.2 Configuration ................................................ 2427
15.28.3 Limitations .................................................. 2428
15.29 DFShostconfirmationandrecoveryoflostspoofedchannels ................... 2428
15.29.1 LimitationsofDFS-hostconfirmationfeature ....................... 2431
15.29.2 HostDFSTesting–SpoofCheckPassed ........................... 2432
15.29.3 HostDFSTesting–SpoofCheckFailed ........................... 2432
15.29.4 HostDFSTesting–RealRadar .................................. 2433
15.29.5 HostDFSTesting–RealRadar:ChannelChangeFailure .............. 2433
15.29.6 HostDFSCheck:SpoofPulses................................... 2434
15.29.7 FWactionaftersendingspoofradar ............................... 2434
15.29.8 Hostaction–Design ........................................... 2435
15.29.9 FirmwareandHostInteraction-Part1............................. 2435
15.29.10 FirmwareandHostInteraction-Part2............................. 2436
15.29.11 NormalDFSoperation ......................................... 2436
15.29.12 DFShostconfirmation—Designflow ............................ 2437
15.29.13 WMIcommandsandevents ..................................... 2437
15.30 Supportforuser-spacetoolforACSalgorithmevents ......................... 2438
15.31 Enhanced zero-wait DFS for automatic switchover to user-selected DFS channels . . . 2441 15.31.1 Sampleconfigurationscenario ................................... 2444
15.32 Initiation of active scanning by repeater AP with root AP hidden SSID in DFS channels . . 2444
15.33 BandwidthAgileDFS .................................................. 2446 15.33.1 SEG/SDIXandchannelmarking ................................. 2447 15.33.2 AgileDFSdesignchanges ...................................... 2447
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 67 MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
15.33.3 Algorithmforbandwidthadjustment .............................. 2448
15.33.4 Limitations .................................................. 2449
15.33.5 Enhancementtoradartool ....................................... 2449
15.34 Display RSSI for IPQ807x/IPQ807xA/IPQ817x and IPQ60xx/IPQ50xx and QCN61xx + IPQ50xx/QCN90xx/QCN602x + IPQ807xA/IPQ60xx/IPQ50xx platforms 2450
15.34.1 Sampleconfigurationscenarios .................................. 2451
15.35 APchannel(40MHz/80MHz)switchingenhancements ....................... 2453 15.35.1 Sampleconfigurationscenario ................................... 2454
15.36 NOLinfirmwareforIPQ807x/IPQ807xA/IPQ817x........................... 2455
15.36.1 Firmwareimplementation ....................................... 2455
15.36.2 WMIinterfacebetweenhostandfirmware.......................... 2458
15.36.3 Datastructures,timers,andfunctionsinfirmware .................... 2458
15.36.4 NOL check in firmware and regulatory compliance . . . . . . . . . . . . . . . . . . . 2460
15.37 Smart mesh enhancements based on monitor-direct feature for IPQ807xA, IPQ817x, and IPQ60xx/IPQ50xx and QCN61xx + IPQ50xx/QCN90xx/QCN602x + IPQ807xA/IPQ60xx/IPQ50xx 2461
15.38 OBSS_PDspatialreuse .................................................
15.38.1 Designenhancements ..........................................
15.38.2 Hostandtargetmessages .......................................
15.38.3 INIparameterstoconfigureselfspatialreuse .......................
15.38.4 INI parameters to configure Spatial Reuse Parameter Set Element . . . . . . .
15.38.5 cfg80211tool commands to configure Spatial Reuse Parameter Set Element
2475
15.38.6 cfg80211toolcommandsforselfspatialreuse .......................
15.38.7 Spatialreusestatistics ..........................................
15.38.8 Behaviorofself-OBSSPDconfigurationsettings ....................
15.38.9 BasicfeaturesforOBSSPDspatialreuse ..........................
15.39 Generate channel frequency response dump for IPQ4019 platforms . . . . . . . . . . . . . .
15.39.1 GuidelinesforworkingwithCFRdumpgeneration...................
15.39.2 Designoverview ..............................................
15.39.3 FormatoftheCFR ............................................
15.39.4 Intercommunicationbetweenhostandfirmware .....................
15.39.5 Configureperiodicandper-peerCFRcapture .......................
15.39.6 Periodic channel frequency response dump capture parameters . . . . . . . . .
15.39.7 Start or stop channel frequency response dump capture per peer . . . . . . . .
15.40 RU26-intolerantOBSS .................................................
15.41 IncludehomechannelinformationinchannelrankingofCBS ...................
15.42 Zero-waitDFSautochannelswitchfor160MHz .............................
15.42.1 Designoverview ..............................................
15.43 Dual5GHz802.11axSBS............................................... 15.43.1 Offlinecalibrations ............................................
15.43.2 Boarddatafile ................................................ 15.44 QCNIE(PHYproprietaryfeatures) ....................................... 15.44.1 High-leveldesign .............................................
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
2462 2469 2469 2474 2475 ...
2477
2481
2483
2484
2486
2486
2487
2492
2501
2515
2517
2517
2518
2519
2520
2520
2523
2523
2524
2525
2525
68
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
80-YA728-6 Rev. YV
15.44.2 QCNIEformat ............................................... 2525
15.44.3 Interactionbetweenhostandfirmware ............................. 2527
15.44.4 Host-specificchanges .......................................... 2527
15.45 Generate channel frequency response dump for IPQ807xA platforms . . . . . . . . . . . . . 2530
15.45.1 GuidelinesforworkingwithCFRdumpgeneration................... 2530
15.45.2 Designoverview .............................................. 2531
15.45.3 CFRmoduleinitialization ....................................... 2533
15.45.4 Periodicandone-shotcapture .................................... 2534
15.45.5 DBRandTxevents ............................................ 2535
15.45.6 Relaydatatouserspace ........................................ 2537
15.45.7 StartandstopCFRcapture ..................................... 2542
15.45.8 SampleCFRdumpforIPQ807Ax ................................ 2543
15.46 AgileDFSscanfor20,40,80,160,and80_80MHz .......................... 2580
15.47 Agile DFS on IPQ807xA and QCN90xx/QCN602x + IPQ807xA platforms . . . . . . . . 2585
15.47.1 HALPHYPHYlayeroperations .................................. 2589
15.47.2 Supportedmodesandoperations ................................. 2591
15.47.3 SampleconfigurationforAgileDFS .............................. 2592
15.48 Generate CFR with unassociated clients and AoA phase calibration data . . . . . . . . . . 2595
15.48.1 HostandfirmwareInterfacedesign ............................... 2595
15.48.2 HostsupportforCFRcaptureinunassociatedclients ................. 2597
15.48.3 HostchangesforAoAcalibrationdata ............................. 2598
15.49 Enhanced ACS reporting for real-time NF dBm reading for IPQ807xA chipsets . . . . . 2599
15.49.1 InteractionbetweenhostandFWinterface.......................... 2599
15.49.2 WMIstructure ................................................ 2600
15.49.3 HALPHYAPI................................................2600
15.49.4 ACSreportdisplay ............................................ 2601
15.49.5 Guidelinesfordisplayingreal-timeNFdBminACSreport ............ 2602
15.50 Auto channel selection optimization using target provided channel grading metrics . . 2602
15.50.1 ACSwithtarget-providedchannelgrading.......................... 2603
15.50.2 ICMwithtarget-providedchannelgrading .......................... 2605
15.50.3 Algorithmandloggingenhancements ............................. 2606
15.51 ScanduringDFSwaittime .............................................. 2606
15.52 Generate channel frequency response dump for IPQ60xx and QCN90xx/QCN602x platforms 2608
15.52.1 DesignoverviewofCFRfunctionality ............................. 2611
15.52.2 CFRmoduleinitialization ....................................... 2616
15.52.3 CorrelationofDBRandTx/Rxevents ............................. 2618
15.52.4 Relaydatatouserspace ........................................ 2631
15.52.5 CFRmoduledeinitialization ..................................... 2637
15.52.6 CoexistenceofCFRwithotherfeatures ............................ 2638
15.52.7 StartandstopCFRcapture ..................................... 2638
15.52.8 Configure repetitive channel capture using wlanconfig commands . . . . . . . 2639
15.52.9 DatastructuresforCFRcapture .................................. 2646
Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 69
MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
15.52.10 15.52.11 15.52.12 15.52.13 15.52.14
ApplicationtoWMIinterface .................................... 2653 LimitationswithCFRcaptureforIPQ60xx ......................... 2654 EnhancementstoCFRforQCN90xx/QCN602x ..................... 2655 LimitationsforCFRcaptureonQCN90xx/QCN602x ................. 2657 SampleCFRdumpforIPQ60xx .................................. 2658
15.53 Contiguous 160/165 MHz support on QCN90xx/QCN602x platforms . . . . . . . . . . . . . 2674 15.53.1 160MHzsupport ............................................. 2674 15.53.2 165MHzsupport ............................................. 2675
15.54 Legacy DFS and 160/165 MHz support on QCN90xx/QCN602x platforms . . . . . . . . 2675 15.54.1 Hostdebugcommands ......................................... 2677 15.54.2 Configurationcommands ....................................... 2678
15.55 4KQAMWLANmodulationonQCN90xx/QCN602xplatforms ................ 2678 15.55.1 Host–FWinteractionduringinitialization ......................... 2680 15.55.2 Over-the-airinteraction(usingQCNIE) ........................... 2681
15.56 Background scanning algorithm enhancement for fast channel switching on QCN90xx/QCN602x platforms 2683
15.57 Enhancement to disabling NOL in firmware for IPQ807x/IPQ807xA/IPQ817x platforms . 2683
15.57.1 Drawback with previous implementation until SPF.11.1 . . . . . . . . . . . . . . . 2684
15.57.2 WMIinterfacebetweenhostandfirmware.......................... 2685
15.57.3 FW implementation until QCA_Networking_2020.SPF.11.1 . . . . . . . . . . . 2685
15.57.4 FW implementation in QCA_Networking_2020.SPF.11.2 release . . . . . . . 2686
15.57.5 Keydatastructures,timers,andfunctionsinfirmware ................ 2688
15.57.6 AssumptionswithenhanceddisablingofNOL ...................... 2690
15.58 Enhancements to Agile DFS using Rolling CAC functionality to pass Japan and FCC rules 2691
15.58.1 DesignoverviewofRollingCAC ................................. 2691
15.58.2 UsingAgiledetectortoperformRollingCAC ....................... 2692
15.58.3 AgiledetectoronIPQ807x/IPQ807xA/IPQ817x ..................... 2693
15.58.4 AgiledetectoronQCN90xx/QCN602x ............................ 2693
15.58.5 Illustrationofradaronoperatingchannel ........................... 2694
15.58.6 IllustrationofradaronRCACchannel ............................. 2695
15.58.7 IllustrationofradaronRCACandoperatingchannels ................. 2695
15.58.8 EnableandconfigureRollingCAC ............................... 2695
15.59 AgileDFSonQCN90xx/QCN602xplatforms ............................... 2696 15.59.1 Hostdebugcommands ......................................... 2698 15.59.2 Configurationcommands ....................................... 2699
15.60 ACS and ICM enhancements to select radar blocked channels while interference during pre- CAC 2701
15.60.1 DesignchangestoACS......................................... 2701
15.60.2 DesignchangestoICM......................................... 2703
15.60.3 ConfigureACS/ICMpre-CACsupport ............................ 2704
15.61 SupportforCFRcaptureonSTA VAPs ..................................... 2705
15.62 UsingthestatemachineframeworkforAgilePre-CAC ........................ 2706
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 70 MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide
Contents
80-YA728-6 Rev. YV
71
15.63 ReturningtotheNOLexpiredchannel ..................................... 2708 15.63.1 Configure the settings for returning to the NOL expired channel . . . . . . . . 2709
16 Spectralscanandanalysis ............................................. 2710 16.1 GenerationIspectralscan ............................................... 2712 16.1.1 Spectralscanparameters ........................................ 2714 16.1.2 FFTreportformat ............................................. 2714
16.2 GenerationIIspectralscans .............................................. 2716
16.2.1 GenerationIIenhancements ..................................... 2716
16.2.2 Known limitations in AR988x/AR989x spectral scan . . . . . . . . . . . . . . . . . 2719
16.2.3 QCA999x/998xspectralscaneventreporting ....................... 2720
16.2.4 GenerationIIspectralscanconfigurationparameters.................. 2724
16.3 GenerationIIIspectralscans ............................................. 2727 16.3.1 Spectralreportsformat ......................................... 2728
16.3.2 Generation III spectral scan configuration parameters . . . . . . . . . . . . . . . . . 2731 16.4 Softwarearchitectureforspectralscan ..................................... 2734
16.4.1 Spectralhostdriver ............................................ 2734
16.4.2 Generation II/III spectral scan firmware functionality overview . . . . . . . . . 2752
16.4.3 Generation II/III spectral scan host and firmware interaction . . . . . . . . . . . 2752
16.5 Spectral
componentization: User space – Driver interaction (cfg80211 mode) . . . . . . 2759
16.5.1 WEXT ..................................................... 2759
16.5.2 cfg80211 .................................................... 2760
16.5.3 VendorcommandAPIs ......................................... 2765
16.5.4 Mapping of spectral commands in WEXT to CFG80211 vendor commands ...
2771
16.6 Classificationalgorithm ................................................. 2772
16.6.1 Microwaveovendetection ...................................... 2772
16.6.2 Frequencyhoppingspreadspectrumdetection ....................... 2778
16.7 Spectraltool:Command-lineutility ........................................ 2779
16.8 Spectralandclassifierdemoapplication:athssd .............................. 2782
16.8.1 Athssd:Userarguments ........................................ 2783
16.9 Spectraltoolcommandsanddebugenhancements ............................. 2785
16.9.1 spectraltoolcommands ......................................... 2785
16.9.2 Spectraldebugenhancements .................................... 2786
16.9.3 Spectralclassificationdebugenhancementstoathssd ................. 2787
16.10 Direct DMA debug framework for spectral scan . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 2789
16.10.1 Guidelines for direct DMA framework debug for spectral scan . . . . . . . . . . 2789
16.10.2 ConfigureDMAbufferdebugforspectralscan ...................... 2790
16.10.3 DesignoverviewofdirectDMAdebugforspectralscan............... 2791
16.11 Agile spectral scan on IPQ807x, IPQ807xA, and IPQ817x chipsets for 5 GHz . . . . . . 2796
16.11.1 Spectralscandesign ........................................... 2797
16.11.2 Spectralusage ................................................ 2805
16.11.3 Agile spectral design in QCA_Networking_20120.SPF.11.1 release and later . . 2805
Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets
MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
80-YA728-6 Rev. YV
16.11.4 GuidelinesforworkingwithAgilespectralscan ..................... 2813 16.12 SpectralscanenhancementsforQCN90xx/QCN602x ......................... 2814
16.12.1 Registerconfigurationchanges ................................... 2814
16.12.2 DDRbufferformatchange ...................................... 2814
16.12.3 165MHz(Restricted160MHz) .................................. 2815
16.12.4 dBmformatreporting .......................................... 2817
16.13 AgilespectralscaninQCN90xx/QCN602x ................................. 2817
16.13.1 ChangeinWMIinterfaceforsupporting160and165 ................. 2817
16.13.2 ChainconfigurationforQCN90xx/QCN602x ....................... 2818
16.13.3 QCN90xx/QCN602x scan register programming changes . . . . . . . . . . . . . . 2819
16.13.4 CalibrationchangesforaSpectral ................................. 2820
16.13.5 QCN90xx/QCN602xscan+Rxdatacoexistence .................... 2820
16.13.6 Agilespectralusage ........................................... 2821
16.13.7 Limitations in QCN90xx/QCN602x for Agile spectral scan . . . . . . . . . . . . 2822
17 Repeateraccesspointfunctions ........................................ 2823 17.1 PAPRDfunctionality ................................................... 2823
17.1.1 OverviewofPAPRD ........................................... 2823
17.1.2 ImplementationofPAPRD ...................................... 2825
17.2 WDSfunctionality ..................................................... 2829
17.2.1 WDSoverview ............................................... 2830
17.2.2 WDSconfigurationcommands ................................... 2831
17.2.3 WDSimplementationwithoutoffload ............................. 2831
17.2.4 802.11acoffloadWDSimplementation ............................ 2832
17.2.5 NAWDS .................................................... 2832
17.3 ExtenderAPfunctionality ............................................... 2839
17.3.1 ConfigurationofextenderAP .................................... 2839
17.3.2 FeaturedescriptionofextenderAP ................................ 2840
17.3.3 APconfigurationmode ......................................... 2841
17.3.4 Top-leveldesignoverview ...................................... 2843
17.3.5 Frameprocessing ............................................. 2844
17.3.6 ImplementationofextenderAP .................................. 2845
17.4 ExtenderAPcomponentization ........................................... 2845 17.4.1 High-leveldesign ............................................. 2846 17.4.2 Componentizationdesign ....................................... 2847 17.5 ProxySTAfunctionality ................................................. 2848
17.5.1 ProxySTAvs.WDS ........................................... 2848
17.5.2 Terminology ................................................. 2848
17.5.3 OverviewofProxySTA ......................................... 2849
17.5.4 MACAddressTranslation ...................................... 2849
17.5.5 ConfigurationToolsSupportforProxySTA ......................... 2854
17.5.6 ProxySTAConfiguration:End-userperspective...................... 2854
17.5.7 QWRAPfunctionality .......................................... 2855
Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 72
MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
17.6 QWRAPsupportfortri-radiostandalonerepeater ............................ 2871
17.6.1 Featurerequirement ........................................... 2871
17.6.2 Designoverview .............................................. 2872
17.6.3 Datastructure ................................................ 2873
17.6.4 Routetrafficalwaysthroughprimaryradio ......................... 2874
17.6.5 Failsafe ..................................................... 2875
17.6.6 Wiredclientaddition ........................................... 2877
17.7 DBDCrepeaterfunctionality ............................................. 2878
17.7.1 ChallengesforDBDCrepeater ................................... 2878 17.7.2 DesignforDBDCrepeater ...................................... 2880
17.8 Specialpackethandlingforloopavoidanceandloadbalancing .................. 2881 17.8.1 Implementation of Tx and Rx data flows for DBDC repeater . . . . . . . . . . . 2885 17.8.2 ConfigurationofTxandRxdataflowsforDBDrepeater .............. 2885
17.9 Interfacemanager(iface_mgr)application .................................. 2887
17.9.1 global_wdsmode ............................................. 2887
17.9.2 fast_lanemode ............................................... 2889
17.10 Automatic addition of Ethernet client to ProxySTA in QWRAP mode . . . . . . . . . . . . . 2890
17.10.1 ConfigurationofWRAPDapplication ............................. 2892
17.10.2 UCIconfiguration ............................................. 2893
17.10.3 Limitations .................................................. 2893
17.11 EnhancedIndependentRepeaterscanalgorithm .............................. 2893
17.12 QWRAP limitations with range extender placement and auto-configuration . . . . . . . . 2896
17.13 Support for same SSID on root and repeater APs in star topology in QWRAP . . . . . . 2897
17.13.1 Designoverview .............................................. 2897 17.13.2 Supporteddeployments ......................................... 2898 17.13.3 Configuration ................................................ 2899 17.13.4 Guidelines ................................................... 2899 17.13.5 GloballydisablesameSSIDfeatureusingUCIsettings................ 2900
17.14 EnableordisableDPDinhighband ....................................... 2900
17.15 Enabledual-bandselectableQCA9984radio ................................ 2901
17.15.1 Assumptions ................................................. 2902
17.15.2 Limitations .................................................. 2902
17.15.3 Design ...................................................... 2902
17.16 BandsteeringinQWRAPmode .......................................... 2904
17.16.1 Verify single AP band steering daemon is running, stadb logs and bandmon logs 2905
17.16.2 Verify preassociation steering 11k/v clients based on 2.4GHz overload detection 2905
17.17 WLANcalibrationdatastoragefor2.4GHzand5GHzinEEPROM ............. 2906
17.17.1 Save calibration data to EEPROM on QCN90xx/QCN602x . . . . . . . . . . . . 2907
17.18 WPS enhancement for range extenders and repeater WPS configuration using a single push button 2907
17.18.1 Implementation ............................................... 2907
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 73 MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide
Contents
80-YA728-6 Rev. YV
74
17.19 TxpacketreinjectionoptimizationforNAWDS .............................. 17.20 ImprovementsforASTEntryhandlingfortheWDSscenarios ..................
17.20.1 Host-FWhandshakeforpeerdeleteoptimization.....................
17.20.2 Validation mechanism of peer deletion involving WDS AST entries . . . . .
17.21 DBDCrepeatersupportonmulti-SoCplatforms..............................
17.21.1 Scenario1:Primarystationreception ..............................
17.21.2 Scenario2:Primary/secondarystationtransmission ..................
17.21.3 Scenario3:Secondarystationreception ............................
17.21.4 Scenario4:SecondaryAPreception...............................
17.21.5 Handleroamingscenarios .......................................
17.21.6 CommandstoconfigureDBDCrepeaterformulti-SoC................
17.22 EnablingtherepeatermodeAPtousemaxPHYcapabilities .................... 17.23 SupportforWDSextendedfeature ........................................
17.23.1 WDS—Backhaulstationlearningandnetdevicecreation ..............
17.23.2 WDS—Backhaulstationdeletion .................................
17.23.3 ConfigureWDSextendedfeature .................................
18 Voiceandmultimediafeatures ..........................................
18.1 WMMflowcontrolandbuffermanagement .................................
18.1.1 WMMterminology ............................................
18.1.2 WMMoverview ..............................................
18.1.3 WMMimplementation .........................................
18.1.4 WMMandreceivepath.........................................
18.1.5 ConfigurationofWMM ........................................
18.2 VoiceEnterprise ....................................................... 18.2.1 ImplementationofVoiceEnterprise ............................... 18.2.2 802.11k ..................................................... 18.2.3 Sourcecodefor802.11k ........................................
18.3 Videooverwirelessfunctionality .........................................
18.3.1 VoWacronyms ...............................................
18.3.2 VoWfeatures.................................................
18.3.3 Video over wireless (Offload) . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
18.4 SmartAntenna ........................................................
18.4.1 SmartAntennasystem .........................................
18.4.2 SmartAntennaoverview ........................................
18.4.3 Smartantennaimplementation ...................................
18.5 UnifiedSmartAntennaAPI ..............................................
18.5.1 Termsanddefinitions ..........................................
18.5.2 UnifiedSmartAntennaAPIobjectives.............................
18.5.3 SmartAntennainterfacemodule..................................
18.5.4 UnifiedSmartAntennaAPIfunctions .............................
18.5.5 ShareddatastructuresforSmartAntenna...........................
18.5.6 ParameterdecodingforSmartAntennaAPIs ........................
Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets
2908
2909
2910
2911
2912
2913
2914
2915
2915
2916
2916
2916
2918
2918
2921
2922
2923
2923
2923
2923
2925
2929
2930
2930
2932
2932
2935
2936
2936
2937
2961
2968
2968
2970
2975
2982
2982
2982
2982
2983
2992
2995
MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
18.6 SupportforCBSforVoWscanningandswitchingchannels .................... 3003
18.6.1 Limitationsoflegacyscan ...................................... 3005
18.6.2 CBSoperations ............................................... 3005
18.6.3 Dwelltimereduction........................................... 3005
18.6.4 CBSchannelmanagement ...................................... 3007
18.6.5 CBSdwellsplittimesynchronization.............................. 3007
18.6.6 Homechannelswitching ........................................ 3008
18.6.7 ConfigureCBS ............................................... 3008
18.7 ExtendedVoWstatistics................................................. 3009
18.7.1 HostdebugchangesforextendedVoWstatistics ..................... 3009
18.7.2 FirmwarechangesforextendedVoWstatistics ...................... 3010
18.7.3 FirmwaredebugchangesforextendedVoWstatistics ................. 3010
18.7.4 UsageofVoWpacketcounters ................................... 3010
18.7.5 Wi-Fihost ................................................... 3011
18.7.6 Wi-Fifirmware ............................................... 3012
18.8 Improved VoW performance with DSCP-to-priority mapping in NSS . . . . . . . . . . . . . 3012 18.8.1 NSSdriver...................................................3013
18.8.2 NSSfirmware ................................................
18.8.3 ECM .......................................................
18.9 DistributedVoW.......................................................
18.9.1 Designenhancements ..........................................
18.9.2 Avoidingpacketloss ...........................................
18.9.3 ImprovementsfordebuggingVoWproblems ........................
18.9.4 Softwareworkaround ..........................................
18.9.5 WifitoolcommandsfordistributedVoW ...........................
18.9.6 Firmware implementation for distributed VoW . . . . . . . . . . . . . . . . . . . . . .
18.9.7 EnableVoW .................................................
18.9.8 ConfigureMSDUTTL .........................................
18.10 Smart Antenna for IPQ807xA, IPQ817x, and IPQ60xx/IPQ50xx and QCN61xx + IPQ50xx/QCN90xx/QCN602x + IPQ807xA/IPQ60xx/IPQ50xx platforms 3021
18.10.1 SmartAntennaarchitecture......................................
18.10.2 Firmwaredesignenhancements ..................................
18.10.3 Controlpath..................................................
18.10.4 Trainingandfeedbackdesign ....................................
18.10.5 ConfigureSmartAntennasettings ................................
18.11 MaintainLayer2CoSandWMMtrafficclassification.........................
18.12 ConversionofmulticastpacketstounicastpacketsforIGMP ...................
18.12.1 ConfiguremulticasttounicastconversionforIGMP ..................
18.12.2 Working of VoW IGMP enhancements in NSS offload mode . . . . . . . . . . .
19 Wi-FiSON:SteeringandAPS ........................................... 19.1 UnderstandingWi-FiSON ............................................... 19.1.1 Termsandacronyms ...........................................
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
3015
3015
3016
3016
3017
3017
3018
3019
3020
3020
3020
3023
3024
3024
3029
3031
3034
3035
3036
3037
3038
3039
3040
75
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
80-YA728-6 Rev. YV
19.2 SingleAPbandsteering ................................................. 3040
19.2.1 Configurationbasics ........................................... 3042
19.2.2 Typesofsteeringandconditions .................................. 3043
19.2.3 BTMcomplianceoverview ...................................... 3051
19.2.4 Steeringsafetyandhysteresis .................................... 3052
19.2.5 Advancedconfigurationparameters ............................... 3054
19.2.6 LogginganddebugCLI ........................................ 3056
19.2.7 Bandsteeringarchitecture....................................... 3060
19.2.8 Estimationalgorithms .......................................... 3066
19.2.9 Disableblacklistfunctionalityinbandsteering ...................... 3067
19.2.10 Disable Wi-Fi SON blacklist functionality in band steering . . . . . . . . . . . . 3068
19.2.11 ConfigurebandsteeringperSSIDpair ............................. 3069
19.3 Multi-APcoordinatedsteering ............................................ 3070
19.3.1 Multi-APcoordinatedsteeringprocesses ........................... 3071
19.4 APsteeringforlegacyclients ............................................ 3077
19.4.1 Designprinciplesforsteeringoflegacyclients ...................... 3078
19.4.2 ConfigurationforAPsteeringoflegacyclients ...................... 3081
19.4.3 Enhanced AP steering of 802.11k unfriendly clients as legacy clients . . . . . 3083
19.4.4 APsteeringforlegacyclientsonQCA9886chipsets .................. 3083
19.5 Wi-FiSON:SkipPFSandimproveairtimecalculation ........................ 3083
19.5.1 Overviewofsteeringfeatures .................................... 3084
19.5.2 Designandimplementation ..................................... 3085
19.5.3 Verifythesteeringenhancements ................................. 3086
19.6 Adaptivepathselection ................................................. 3087
19.7 Suspensionofprobesin2.4GHzband ..................................... 3095
19.8 SSIDsteering ......................................................... 3096
19.9 Soft-blockingforsafeconnections ........................................ 3100 19.9.1 Designguidelines ............................................. 3102 19.9.2 Commandsforsoft-blocking .................................... 3103
19.10 cfg80211supportforWi-FiSON.......................................... 3104
19.11 Handle client steering without sending a disassociate or deauthentication event . . . . . 3108
19.11.1 Designoverview .............................................. 3109
19.11.2 Handlingclientsteeringissues ................................... 3111
19.11.3 Implementation of client steering without deauthentication . . . . . . . . . . . . . 3112
19.12 DataElementscommercialization ......................................... 3113
19.12.1 Datamodelparameters ......................................... 3116
19.12.2 Dataelementsmodulestructure .................................. 3117
19.12.3 UCIconfigurationofdataelements ............................... 3117
19.12.4 Implementationofdataelements ................................. 3118
19.12.5 Supportedelementsforeachnode ................................ 3119
19.12.6 NorthBoundEventnotificationsupport ........................... 3134
19.12.7 Healthmonitorapplicationsupport................................ 3135
19.12.8 Prerequisites for compiling single and multiple AP modes in data elements 3135
Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 76
MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide
Contents
19.12.9 Configure single AP and multi-AP mode in data elements . . . . . . . . . . . . . 3135
19.12.10 Assumptions for configuring single and multi-AP modes in data elements . 3137
19.13 Supportinteroperationwithdual-bandandtri-bandmeshnodes ................. 3138
19.13.1 Credentialcloningacrossheterogeneousmeshnodes ................. 3138
19.13.2 APsteeringacrossdifferentchannels .............................. 3140
19.13.3 Bestuplinknodeselection ...................................... 3142
19.13.4 Guidelines for interoperation between dual-band and tri-band mesh nodes . 3144
19.13.5 Diagnosticsandtraces.......................................... 3145
19.13.6 Configure interoperation with dual-band and tri-band mesh nodes in Wi-Fi SON 3145
19.14 ImproveddynamicandstaticmemorytrackingforWi-FiSON .................. 3146
19.14.1 Wi-FiSONdynamicmemorytrackingimplementation ................ 3146
19.14.2 UCI configuration for Wi-Fi SON dynamic memory computation . . . . . . . 3149
19.14.3 UtilitytoretrieveSON/MAPmemoryusagestatistics ................. 3156
20 Wi-FiSON:Additionalfeatures ......................................... 3158
20.1 Rangeextenderplacementandauto-configuration ............................ 3158
20.1.1 Range extender automatic configuration and mode switching . . . . . . . . . . . 3159
20.1.2 Rangeextenderplacementassistance .............................. 3167
20.1.3 Usingrepacd ................................................. 3172
20.1.4 Viewlogsofrepacd............................................ 3173
20.1.5 SamplescenarioonLEDsplacement .............................. 3173
20.2 Wi-FiSON:Daisychainandbestuplinkselection ............................ 3174
20.2.1 Information elements for Wi-Fi SON daisy chain and best uplink selection 3175 20.2.2 Configurationparametersforbestuplinkselection ................... 3179
20.3 Wi-Fi SON: Enhanced best uplink selection algorithm for multiple hops of CAP and REs . 3180
20.3.1 Enhanced best-uplink selection algorithm operations . . . . . . . . . . . . . . . . . 3181
20.3.2 Sampleconfigurationscenarios .................................. 3182
20.4 Wi-FiSON:Multi-SSIDandtrafficseparation ............................... 3183
20.4.1 High-leveldesignofmulti-SSIDandtrafficseparation ................ 3183
20.4.2 Setupofmulti-SSIDandtrafficseparation .......................... 3183
20.4.3 Configuration changes for multi-SSID and traffic separation . . . . . . . . . . . 3184
20.4.4 Driverchanges ............................................... 3186
20.5 Wi-FiSON:SupportacrossmultipleHy-Fibridges ........................... 3186
20.6 EnhancedWPSforREtoestablishPBCconnectioninWi-FiSON ............... 3189
20.7 Credentialcloning ..................................................... 3192
20.8 Wi-Fi SON: Cloning of backhaul VAP credentials for multi-SSID with traffic separation . 3194
20.9 Wi-FiSON:FullDaisyChainsupportacrossmultiplehops ..................... 3196 20.9.1 Samplefulldaisy-chaintopology ................................. 3202
20.10 SaveSTAinformationtoflashforWi-FiSON ............................... 3205
20.11 Wi-FiSON:Temporarilydisableaccessinterface ............................. 3207
20.12 FronthaulchangesdonotrestartbackhaulinWi-FiSON ....................... 3208
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 77 MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide
Contents
20.13 Wi-Fi SON: Channel planning on 2.4 GHz bands for distributed Wi-Fi systems . . . . .
20.13.1 Commandstoaccessinnetworkinformation ........................
20.13.2 Channelplanningon2.4GHzbands ..............................
20.13.3 Sampleconfigurationscenarios ..................................
20.14 Wi-FiSON:Ethernetroamingperport ..................................... 20.15 Wi-FiSONAPIforlbdblacklist .......................................... 20.15.1 Sampleconfigurationscenarios .................................. 20.16 Separate Wi-Fi SON AP steering threshold values for 2.4 GHz and 5 GHz bands . . . . 20.17 DisableWi-FiSONblacklistfunctionalityinbandsteering ..................... 20.18 Wi-FiSON:MultinodeWPSsupportforpushbuttonevents ....................
20.18.1 Supportedconfigurationscenarios ................................
20.18.2 Changesinbehavior ...........................................
20.18.3 GuidelinesforworkingwithmultinodeWPS ........................
20.18.4 WPSWi-FiSONprocessingofthePBCpress-event ..................
20.18.5 ConditionswhentheWPSprocessisstopped .......................
20.19 ConfigurebestuplinkhysteresisforWi-FiSON .............................. 20.20 Wi-FiSON:Diagnosticsandtroubleshooting ................................
20.20.1 Wi-FiSONdiagnosticsdesign ...................................
20.20.2 Wi-FiSONdiagnosticsalgorithm.................................
20.20.3 Functionalityandcomponents ...................................
20.20.4 ConfigureWi-FiSONdiagnostics ................................
20.21 Wi-FiSONlibrariesforintegrationwiththird-partyvendors ....................
20.21.1 Newfilesaddedforlibraries .....................................
20.21.2 ImportantWi-FiSONlibrarystructures ............................
20.21.3 DeterminetheunderlyingvendorforWi-FiSONmodules .............
20.21.4 Vendorinitialization ...........................................
20.21.5 StructureandEnumchanges .....................................
20.21.6 Handlingofevents ............................................
20.21.7 Sampleconfigurationscenario ...................................
20.21.8 ValidateLBDevents ...........................................
20.21.9 ValidateHYDevents...........................................
20.22 Wi-FiSON:MechanismforexchangingdatabetweenCAPandREs .............
3209
3211
3212
3212
3214
3215
3218
3224
3227
3228
3229
3229
3230
3230
3231
3231
3232
3232
3233
3234
3235
3235
3236
3237
3238
3240
3242
3243
3244
3247
3250
3253
3254
3254
3255
3257
3257
3259
3259
3263
3269
20.22.1 20.22.2 20.22.3 20.22.4 20.22.5
20.23 Support 20.23.1 20.23.2
Communication between libqca_wifison_ext libraries in CAP and RE . . . . Message definition . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . Integratethecustomerlibraryintocustomermodule .................. Restrictions .................................................. Sampleconfigurationscenarios ..................................
for reporting associated and steering stations for carrier networks . . . . . . . . . ParameterAPIs ............................................... DesignandimplementationofparameterAPIs ......................
20.24 Displaythehydandlbdversions ..........................................
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
78
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
20.25 Wi-Fi SON IE over beacon offload for IPQ807x/IPQ807xA/IPQ817x and IPQ60xx/IPQ50xx and QCN61xx + IPQ50xx/QCN90xx/QCN602x + IPQ807xA/IPQ60xx/IPQ50xx 3270
20.26 Controlthelegacyupgrade-steeringmechanismforclients ..................... 3270
20.26.1 Guidelines for configuring the legacy upgrade-steering mechanism for clients .
3271
20.26.2 Configure the legacy upgrade-steering mechanism for clients . . . . . . . . . . . 3272
20.27 Wi-Fi SON: Reduce the number of switching tables for dedicated backhaul . . . . . . . . 3272
20.28 Wi-FiSON:Guestnetworkinbridgemode.................................. 3274 20.28.1 ExampleofaCAPconfiguration ................................. 3275
20.28.2 Exampleconnectionfromaguestclient ............................ 3276 20.29 Wi-FiSON:GuestNetworkoverEthernetBackhaul .......................... 3277 20.29.1 ExampleofaCAPconfiguration ................................. 3278 20.29.2 ExampleofanREconfiguration.................................. 3280 20.30 UseRSSIfromacknowledgmentpacketsforsteering.......................... 3280 20.30.1 Guidelines for configuring ack-based RSSI for steering . . . . . . . . . . . . . . . 3281
20.31 WPA3supportforWi-FiSON ............................................ 3282
20.31.1 WPA3supportforWi-FiSONdesignoverview ...................... 3282
20.31.2 InteroperabilityinformationforWPA3inWi-FiSON ................. 3284
20.32 Wi-FiSONmeshnodeclient-handlingbasedonclassification................... 3285
20.32.1 Designoverview .............................................. 3286
20.32.2 Functionalflow ............................................... 3288
20.32.3 Sample configuration Wi-Fi SON mesh node client handling based on classification 3289
20.32.4 Guidelines for Wi-Fi SON mesh node client handling based on classification . . 3292
20.33 Collection of Wi-Fi SON statistics using nl80211 vendor command . . . . . . . . . . . . . . 3293
20.34 RCPIsupportforWi-FiSONnetworks ..................................... 3294
20.34.1 GuidelinesforconfiguringRCPIforWi-FiSON ..................... 3296
20.35 Wi-Fi SON modularization for cfg80211tool debug request commands . . . . . . . . . . . . 3297
20.36 IPTVrestartdelay ..................................................... 3305
21 Multi-AParchitecture ................................................... 3307
21.1 Multi-APspecification .................................................. 3307
21.2 Multi-APimplementationdetails .......................................... 3313
21.2.1 ControllerOperation ........................................... 3314
21.2.2 AgentOperation .............................................. 3320
21.2.3 NewDebugCLICommands ..................................... 3324
21.3 Sample Wi-Fi controller and agent onboarding configuration settings . . . . . . . . . . . . . 3326 21.3.1 Controllerconfiguration ........................................ 3326 21.3.2 Agentconfiguration-Ethernetonboarding ......................... 3328 21.3.3 Agentconfiguration-Wi-Fionboarding ........................... 3329
21.4 Sample Controller and Agent configuration for Multi AP commercialization . . . . . . . 3330
21.4.1 Controllerconfiguration-withrepacd(auto) ........................ 3330
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 79 MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
80-YA728-6 Rev. YV
80
21.4.2 Agentconfiguration-Ethernetonboarding(norepacd) ................ 3332
21.4.3 Agentconfiguration-withrepacd ................................ 3333 21.5 Multi-APorEasyMeshR2forhostapd ..................................... 3334 21.5.1 ControllerOperation ........................................... 3334 21.5.2 AgentOperation .............................................. 3337
21.6 EasyMesh1905-onlyoperationmode ...................................... 3340
21.6.1 WorkflowofEasyMesh1905onlyoperationmode ................... 3343
21.6.2 ImplementationofMAP1905-onlyoperationmode .................. 3347
21.6.3 MAP1905messagetypes ....................................... 3349
21.6.4 Enablediagnosticsandlogs ..................................... 3351
21.7 EasyMesh enhancements—legacy AP and backhaul steering, channel planning . . . . . 3351
21.7.1 MAPlegacyAPsteering ........................................ 3351
21.7.2 Backhaulsteering ............................................. 3353
21.7.3 Channelselection ............................................. 3354
21.7.4 UCI parameters for backhaul steering and channel selection in MAP . . . . . 3357
21.7.5 SampleMAPconfiguration ..................................... 3360
21.8 EasyMeshR2commercializationalgorithms ................................ 3368
21.8.1 Configuration of EasyMesh r2 commercialized features . . . . . . . . . . . . . . . 3369
21.8.2 Sample Controller and Agent configuration for Multi AP commercialization . . 3371
21.8.3 Guidelines for using single and multiple bridges with EasyMesh R2 . . . . .
21.9 AdvancedCACimplementationforMAPr1 ................................
21.9.1 Configurationoffallbackfrequency ...............................
21.9.2 Radardetectionandexchangeof1905messages .....................
21.9.3 RadardetectionandexistingbehaviorofCSAandRCSA..............
21.9.4 Sample configuration scenario of advanced CAC for MAP r1 . . . . . . . . . .
21.9.5 Enableloggingfordiagnostics ...................................
21.10 ZeroBSScredentialMAPagentonboardingsupport ..........................
21.10.1 Design overview of the zero BSS credential MAP agent onboarding . . . . .
21.10.2 Implementation of zero BSS credential MAP agent onboarding . . . . . . . . .
21.11 Improved SON-MAP flash and RAM memory footprint with memory profile support
22 Wi-FiSONandPLC ..................................................... 22.1 Wi-FiSON:PLCbackhaul ..............................................
22.1.1 PLCconfiguration.............................................
22.1.2 PLCSONinterfacemapping ....................................
22.1.3 FronthaulAPVAPsandCAPreachability ..........................
22.1.4 Guidelines for configuring Wi-Fi SON interoperation with PLC . . . . . . . . .
22.2 Wi-FiSONwithPLC:Supportfordaisy-chainandstartopologies ...............
22.2.1 Topologybuildingprocess ......................................
22.2.2 Supportedconfigurationscenarios ................................
22.2.3 PLCLinkMetrics .............................................
22.2.4 Band/Interface selection for AP steering . . . . . . . . . . . . . . . . . . . . . . . . . . .
Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets
3383
3383
3384
3384
3386
3386
3388
3388
3389
3390
3392
3394
3394
3398
3399
3400
3400
3400
3402
3403
3404
3404
MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide
Contents
22.2.5 Configuration commands to enable Dynamic Link Metrics . . . . . . . . . . . . .
22.2.6 Guidelinesandlimitations ......................................
22.3 Selection of best interface to connect to uplink node in PLC/Wi-Fi SON daisy chain
network 3406
22.4 Interoperation of different PLC chipset models in a Wi-Fi SON network . . . . . . . . . .
22.5 SupportforREH172asarootAP .........................................
22.5.1 REH172overview.............................................
22.5.2 Softwarearchitectureoverview ..................................
22.5.3 REH172inroutingmode .......................................
22.6 Usingplchelper.shscripttoprioritizePLCfirmwaredownload ..................
22.7 ConfigureSimpleConnectLED ..........................................
23 ConfigureWi-FiSON....................................................
23.1 OverviewofconfiguringWi-FiSON.......................................
23.1.1 Wi-FiSONfeatures............................................
23.1.2 Supportedconfigurations .......................................
23.1.3 Buildsoftware ................................................
23.1.4 Assumptionsandlimitations .....................................
23.2 Wi-FiSONconfigurationparameters ......................................
23.2.1 Load Balancing Daemon (LBD) band and AP steering parameters . . . . . . .
23.2.2 WSPLCDparameters ..........................................
23.2.3 Hybriddaemon(hyd)parameters .................................
23.2.4 RE placement and auto-configuration daemon parameters . . . . . . . . . . . . .
23.3 EnableanddisableWi-FiSON ...........................................
23.4 Configure2-radioAPs(basicconfiguration) ................................. 23.4.1 ConfiguretheCAP ............................................ 23.4.2 ConfigureRE ................................................
23.5 Configure3-radioAPs .................................................. 23.5.1 ConfiguretheCAP ............................................ 23.5.2 ConfigureRE ................................................
23.6 Additionalconfiguration(perfeature) ......................................
23.6.1 PLCbackhaulinWi-FiSON ....................................
23.6.2 Support guest network with traffic separation . . . . . . . . . . . . . . . . . . . . . . .
23.6.3 Interference as input to band steering . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
23.6.4 Airtimefairness(ATF) .........................................
23.6.5 Peerleavingandjoiningnotification ..............................
23.6.6 STA database (STADB) steering parameters over hyd restarts . . . . . . . . . .
23.6.7 Smartmonitor-basedAPsteeringforlegacyclients ...................
23.6.8 Plan channels on 2.4 GHz channel . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
23.7 DebugandanalyzeWi-FiSONproblems ...................................
23.7.1 Command line interface commands to collect necessary logs . . . . . . . . . . . 23.7.2 Debugcommonissues ......................................... 23.8 ViewthecontentsofWi-FiSONIE........................................
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
3405 3405
3413
3417
3417
3419
3421
3425
3425
3426
3426
3427
3428
3429
3429
3429
3429
3439
3442
3455
3461
3462
3462
3463
3464
3464
3466
3467
3467
3468
3469
3469
3469
3470
3470
3471
3471
3472
3474
3476
81
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
80-YA728-6 Rev. YV
24 CoexistenceofWLANformesh ......................................... 3477 24.1 Smartmeshfunctionality ................................................ 3477
24.1.1 VendorIEAPIsupport ......................................... 3477
24.1.2 ACLenhancements ............................................ 3479
24.1.3 802.11eventenhancements ..................................... 3480
24.1.4 802.11stationstatistics ......................................... 3481
24.1.5 Capture802.11framesofnon-connectedclients ..................... 3482
24.1.6 WMIcommands .............................................. 3483
24.1.7 Firmwarechanges ............................................ 3484
24.1.8 Hostandtargetinteraction ...................................... 3486
24.1.9 Supportedhardware ........................................... 3486
24.1.10 UCIconfiguration ............................................ 3486
24.2 NoDSframesupportforMeshfeature...................................... 3487
24.2.1 RequirementsforNoDSframeforMesh ........................... 3487
24.2.2 High-leveldesignofNoDSforMesh .............................. 3488
24.2.3 AdditionalfeaturesforNoDSforMesh ............................ 3493
24.3 BluetoothandWLANcoexistence ........................................ 3498
24.3.1 AssumptionsforBluetoothandWLANcoexistence .................. 3498
24.3.2 Coexistenceinitializationworkflow ............................... 3499
24.3.3 Prioritytable ................................................. 3500
24.3.4 COEXmodule................................................ 3500
24.3.5 BeaconframehandlingduringCOEX ............................. 3501
24.3.6 ManagementFrameHandlingduringCOEX ........................ 3502
24.3.7 WMM_AC_VOframehandlingduringCOEX ...................... 3503
24.3.8 HOSTdriverinterface.......................................... 3503
24.4 CoexistenceofWLANandBluetoothforCSRMesh .......................... 3504 24.5 CoexistenceofWLANandZigBeeforCSRMesh ............................ 3527 24.6 CoexistenceofBluetoothandZigBeewithWLANonIPQ8064 ................. 3547
24.6.1 Behavior of hardware interfaces for Bluetooth/ZigBee and WLAN coexistence 3547
24.6.2 TDMoperationsforcoexistence .................................. 3548
24.6.3 BaselineprioritytableforCOEX ................................. 3550
24.6.4 ConfigureBTcoexistence....................................... 3550
24.6.5 ConfigureBTonthetwodevices ................................. 3551
24.6.6 Loadfirmwareimage .......................................... 3551
24.7 LTEgatewayandLTEcoexistence ........................................ 3551 24.7.1 LTEgatewayconfigurationGUI.................................. 3554 24.8 InteroperationofQCA402xwithIPQ807x .................................. 3555
24.8.1 InstallQCA402xhostpackageonIPQ807x ......................... 3556
24.8.2 LaunchQCA402xhostapplicationonIPQ807x ..................... 3556
24.8.3 RunBLE,ZigBee,ThreadandFWupgrade......................... 3557
24.8.4 FlashQCA402xchiponIPQ807x ................................ 3566
24.8.5 FlashQCA402xchiponIPQ807x ................................ 3569
Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 82
MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
25
3573
24.9.1 Changesindifferentlayers ......................................
24.10 NoDSenhancementsforproprietarymeshinNSSoffloadmode .................
24.10.1 Changingmesh-vaptosupport802.3(TxandRx) ....................
24.10.2 SampleWirelessConfig (MeshPoint-1) .........................
24.10.3 SampleWirelessConfig (MeshPoint-2) .........................
24.10.4 Keyconfiguration .............................................
Logging and statistics for debugging . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
25.1 Packetloggingfunctionality ............................................. 25.1.1 Packetloggingcapability ....................................... 25.1.2 Packetloggingforoffloadplatforms ..............................
25.2 APstatisticstool.......................................................
25.2.1 APstatisticsimplementation.....................................
25.2.2 APstatisticsusage.............................................
25.2.3 APstatisticslisting ............................................
25.2.4 Important notes about AP statistics tool . . . . . . . . . . . . . . . . . . . . . . . . . . . .
25.2.5 Sampleoutputofapstats ........................................
25.2.6 Athstatsenhancementfor802.11acforlegacychipsets ................
25.2.7 TxandRxstatistics ............................................
25.2.8 Sampleoutputoftxrx_statscommand .............................
25.2.9 Supportforbeaconcountandbeaconoutagestatistics.................
25.3 Trackinglatencyandlossof802.11packets .................................
25.4 EnhancedstationstatisticsdisplayforTxandRxframes .......................
25.5 CustomerWLANeventreports ...........................................
25.6 APdiagnosticsforcarrier ...............................................
25.6.1 ConfigurationofAPdiagnosticsforcarrier .........................
25.6.2 High-leveldesignofAPdiagnostics...............................
25.7 Display latency for each PPDU using packet log tool . . . . . . . . . . . . . . . . . . . . . . . . . .
25.7.1 LatencyinformationforeachPPDU...............................
25.7.2 Pktlog–Rutility ..............................................
25.7.3 Sampletestscenarioforper-VAPstatistics .........................
25.8 Enhancedper-peerTIDqueuestatistics.....................................
25.9 QuerythedriverforVAPconfiguration.....................................
25.10 PacketloganalysisforIPQ807x/IPQ807xA/IPQ817xdevices ...................
25.10.1 Prerequisitesforpacketloganalysis ...............................
25.10.2 pktlog-liteutility ..............................................
25.10.3 pktlog-fullutility ..............................................
25.11 FTMdaemon .........................................................
25.11.1 FTMoverview................................................
25.11.2 Architecture..................................................
3574
3583
3583
3583
3584
3585
3587
3587
3587
3589
3591
3592
3593
3597
3599
3600
3604
3605
3606
3675
3676
3677
3680
3683
3684
3684
3685
3686
3687
3688
3690
3694
3695
3696
3696
3697
3697
3698
3699
24.8.6 FTMsupportforQCA402xchiponIPQ807x ....................... 3571 24.9 Wi-Fi, BLE, and 15.4 coexistence with QCA402x on IPQ807xA and IPQ60xx/IPQ50xx . .
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
83
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
80-YA728-6 Rev. YV
25.11.3 VerifyFTMdaemonbringup .................................... 3701
25.11.4 Enable QSDK CNSS Diag on IPQ807x/IPQ807xA/IPQ817x platforms . . . 3701
25.12 QDART for IPQ807x/IPQ807xA/IPQ817x, IPQ60xx, IPQ50xx, QCN61xx + IPQ50xx,
QCN90xx/QCN602x + IPQ807xA/IPQ60xx/IPQ50xx 3706
25.12.1 QDARTcomponents........................................... 3706
25.12.2 Licensing,installation,andconfiguration ........................... 3711
25.12.3 TesttreesforQDART .......................................... 3712
25.12.4 CalibrationsforQDART ........................................ 3714
25.12.5 802.11axtestingmethodology ................................... 3715
25.13 Set up monitor mode on IPQ807x/IPQ807xA/IPQ817x, IPQ60xx, IPQ50xx and QCN61xx + IPQ50xx, QCN90xx/QCN602x + IPQ807xA/IPQ60xx/IPQ50xx platforms 3719
25.14 Querythedriverforradioconfiguration .................................... 3720
25.15 Supportforoff-channelstatisticsperrequestperradio ........................ 3724
25.15.1 Designforoff-channelstatisticssupport............................ 3724 25.15.2 Hostandtargetmessagesforoff-channelstatistics ................... 3725
25.16 Hash-based, radio-based, and flow-based Rx packet steering statistics . . . . . . . . . . . . 3725
25.17 SupportforcontrolframeTxandRxstatistics ............................... 3728
25.18 SupportedTxandRxper-PPDUstatisticaldetails ............................ 3730
25.18.1 Examples of console output for Tx and Rx per-PPDU statistics . . . . . . . . . 3732
25.18.2 Support for Rx statistics to contain MU-MIMO and OFDMA parameters . 3734
25.18.3 Support for Tx statistics to contain MU-MIMO and OFDMA parameters . 3735
25.19 Txpacketlogcapturemechanism ......................................... 3741
25.19.1 Sample configuration scenario for Tx packet log capture . . . . . . . . . . . . . . 3743
25.19.2 KnownlimitationswithTxpacketlogcapture ....................... 3753
25.20 PortingQcmbrBTsupporttoFTM ........................................ 3753 25.20.1 Sampleconfigurationscenario ................................... 3753
25.21 Porting QMSCT client application to networking subsystem on IPQ807x/IPQ807xA/IPQ817x and IPQ60xx/IPQ50xx and QCN61xx + IPQ50xx/QCN90xx/QCN602x + IPQ807xA/IPQ60xx/IPQ50xx 3754
25.21.1 SetupprocessofportingQMSCTclient ............................ 3754
25.21.2 Connection process between QMSCT and FTM application . . . . . . . . . . . . 3756
25.21.3 SetupandtestusingQMSCT .................................... 3758
25.22 Generateruntimetargetcoredump ........................................ 3772
25.23 Enhanced client statistics display for RSSI, Tx/Rx packets, and STBC . . . . . . . . . . . . 3772 25.23.1 Datastructurechangesforenhancedclientstatistics .................. 3773 25.23.2 Sampleoutputofapstatscommand ............................... 3776
25.24 Connectionstateloggingfunctionality ..................................... 3778
25.25 CEloggingfunctionality ................................................ 3779
25.25.1 Storagespaceoflogs........................................... 3779
25.25.2 Storageformatoflogs .......................................... 3780
25.25.3 RetrievalofCElogs ........................................... 3780
25.25.4 UsageinformationofCElogging ................................. 3780
25.25.5 ExamplesofCElogs........................................... 3781
25.25.6 Examplesofsmartlogs ......................................... 3781
Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 84
MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
25.26 Buffertracking ........................................................ 3783
25.27 Enhanced client statistics display for Tx management frames, minimum/maximum RSSI,
and received data MPDUs 3784
25.28 Integration of Wi-Fi statistics with vendors for extended statistics . . . . . . . . . . . . . . . . 3786
25.29 Smartloggingmethod .................................................. 3805
25.29.1 Host-FWinteraction ........................................... 3805
25.29.2 Identificationoftriggerconditions ................................ 3807
25.30 Packet log and Tx completion message correlation to mirror Tx data packets on QCA9880 3808
25.30.1 UniqueIDforTxcompletionindication............................ 3810
25.30.2 Txcompletionindication ....................................... 3810
25.30.3 ManagementTxcompletionindication ............................ 3811
25.30.4 Packetlogmessageformat ...................................... 3812
25.30.5 CallflowsofpacketlogandTxcompletionmessage ................. 3814
25.31 DisplayofdecodedwatchdogtimersignatureforQCA9980 .................... 3816
25.31.1 Mappingofdecodedwatchdogtimerdebuglog...................... 3818
25.32 SmartloggingforHALPHYmodules ...................................... 3823
25.32.1 Host-FWinteractionforsmartlogging ............................. 3823
25.32.2 Implementationdetailsofsmartlogging ........................... 3824
25.32.3 Identificationofcalibrationtriggers—firmware ...................... 3824
25.32.4 Identification of non-calibration triggers—Firmware . . . . . . . . . . . . . . . . . . 3827
25.33 WMIsupportfordebugstatementsinUTF .................................. 3829
25.34 DisplaylatencyforeachPPDUusingpacketlogtool .......................... 3829 25.34.1 Latencyinformation ........................................... 3830 25.34.2 Pktlog–Rutility .............................................. 3830 25.34.3 Sampletestscenarioofper-VAPstatistics .......................... 3831
25.35 EnhancedTIDqueuestatistics ............................................ 3834
25.36 Enhanced client statistics for acknowledgment failures, modulation rates, authentication details 3838
25.36.1 Stationconnectionparameters ................................... 3845
25.37 RetrieveWi-Fimediumutilizationstatistics ................................. 3845
25.38 Enhancements to smart-logging for additional scenario-handling . . . . . . . . . . . . . . . . 3846
25.38.1 Enhancedsmart-loggingdesign .................................. 3847
25.38.2 Enableordisablesmartlogging .................................. 3851
25.38.3 Workflowofhandlingerrorscenariosforsmart-logging ............... 3852
25.39 Set print trace level for specific modules . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3855
25.40 EnableCNSSloggerforwirelessLANAP .................................. 3856
25.41 athdiaganddevmemutilities ............................................. 3857
25.42 WMIinterfacelogging .................................................. 3859
25.42.1 Implementation ............................................... 3859
25.42.2 Sample usage of WMI interface logging . . . . . . . . . . . . . . . . . . . . . . . . . . . 3861
25.43 Packet log filtering on IPQ807x/IPQ807xA/IPQ817x and IPQ60xx, IPQ50xx, QCN61xx +
IPQ50xx, QCN90xx/QCN602x + IPQ807xA/IPQ60xx/IPQ50xx platforms 3862
25.43.1 Assumptionsforpktlogfiltering .................................. 3863
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 85 MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
25.43.2 Softwarecomponents .......................................... 3863
25.43.3 Hostandtargetmessagesforpacketlogfiltering ..................... 3864
25.44 DisplayRxpilotEVMonIPQ807xAandIPQ817xchipsets .................... 3864
25.45 Enable minimum core-dump capture in U-boot on IPQ807x/IPQ807xA/IPQ817x/IPQ60xx
3865
25.45.1 Include critical segments for minimum core-dump capture . . . . . . . . . . . . 3865
25.45.2 ParsegenerateddumpsusingT32simulator......................... 3866
25.46 Rx packet capture enhancements on IPQ807xA, IPQ817x, IPQ60xx, IPQ50xx, QCN61xx + IPQ50xx, and QCN90xx/QCN602x + IPQ807xA/IPQ60xx/IPQ50xx platforms 3868
25.46.1 Sniffermodes ................................................ 3869
25.46.2 StatusringTLV ............................................... 3870
25.46.3 Rxpacketcapturedesign ....................................... 3873
25.46.4 Rxpacketcaptureoperations .................................... 3874
25.46.5 EnableRxpacketcaptureenhancementmode ....................... 3876
25.46.6 Commandtoenableenhancedcapturemode ........................ 3877
25.46.7 Register function prototype for WDI_EVENT_RX_MPDU . . . . . . . . . . . . 3877
25.47 Tx packet capture enhancements on IPQ807xA, IPQ817x, IPQ60xx, IPQ50xx, QCN61xx + IPQ50xx, QCN90xx/QCN602x + IPQ807xA/IPQ60xx/IPQ50xx platforms 3881
25.48 Enhancedpacketloginformationcollectionfordatapath ...................... 3889
25.49 Enhanced statistics for troubleshooting scheduler problems . . . . . . . . . . . . . . . . . . . . . 3894
25.49.1 TxQ/Radio-levelstatistics ....................................... 3895
25.49.2 Peerstatistics ................................................. 3896
25.49.3 Latencyprofiling .............................................. 3897
25.49.4 Pktlogscriptchanges .......................................... 3898
25.50 DebugenhancementsforDLMU-MIMOmulti-clientscenarios ................. 3899
25.51 EnhanceddisplayofpeerstatisticsandRSSIreporting ........................ 3901 25.51.1 Commandforpeerstatistics ..................................... 3901
25.51.2 wifistats command for peer statistics . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3902 25.51.3 Firmwaredesignenhancements .................................. 3904 25.51.4 Guidelines for enhanced display of peer and RSSI statistics . . . . . . . . . . . . 3904
25.52 Copyengine(CE)latencystatistics ........................................ 3905
25.53 Compressionofcrashdump.............................................. 3905
25.54 Enhancedcaptureofminimumcore-dumpinU-boot .......................... 3907
25.55 Enhanced Tx packet capture for control and management frames need payload for both hardware and firmware-generated control frames 3908
25.55.1 Runtime enabling/disabling of feature and build configuration . . . . . . . . . . 25.55.2 Unittestcommand ............................................ 25.55.3 Txcapturemanagement/controlblock ............................. 25.55.4 Register function prototype for Tx capture mgmt/ctrl frame . . . . . . . . . . . .
25.56 Enhanced Tx packet capture meta data in radiotap format support . . . . . . . . . . . . . . . . 25.56.1 Txcaptureradiotapupdate ...................................... 25.56.2 Register function prototype for Tx capture radiotap update . . . . . . . . . . . . . 25.56.3 ListofsupportedfieldsforTxcaptureradiotapformat ................
25.57 DebugFSimprovementsforWMIlogging ..................................
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
3909
3909
3910
3910
3910
3911
3911
3912
3915
86
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide
Contents
25.58 athdiagoverQMIforQCN90xx/QCN602xplatforms .........................
25.58.1 CLIimplementation ...........................................
25.58.2 Wordread ...................................................
25.58.3 Wordwrite...................................................
25.58.4 Blockread ...................................................
25.58.5 Blockreadandsaveintofile .....................................
25.58.6 ExamplesofathdiagoverQMIcommands..........................
25.59 Dynamicconfigurationtohostdatastructureminidump........................ 25.59.1 Designenhancementsforminidumpdebug ......................... 25.60 HALPHYpacketlogenhancements .......................................
25.60.1 Defineprototypefordatasetorstructure ...........................
25.60.2 HALPHYpacketloginformation .................................
25.61 SetupfullmonitormodeonQCN90xx/QCN602xchipsets ..................... 25.61.1 Configuration setup for full monitor mode on QCN90xx/QCN602x . . . . . . 25.62 LogICMP/EAPOL/ARPpacketcountsperpeer .............................. 25.63 CopyEngine-basedfirmwareloggingonQCN90xx/QCN60xx ..................
25.63.1 DesignoverviewofCopyEngine-basedlogging .....................
25.63.2 Hostimplementation ...........................................
25.64 Extending wifistats command for displaying control path statistics . . . . . . . . . . . . . . .
25.64.1 WMIcommandsandeventsforhostandtargetmessaging .............
25.64.2 LibraryfileforinputparseatCLI.................................
25.64.3 ParsingWMIcontrolpathstatisticsandsendingevent ................
25.64.4 UsageguidelinesforwifistatswifiXstats_num-wmi .................
25.65 Enable live minimum core-dump capture on IPQ807x/IPQ807xA/IPQ817x/IPQ60xx 25.65.1 Overviewofliveminidump ..................................... 25.65.2 Usetheliveminidumpfeature ...................................
25.66 Additionalmodeform_copytosendfirstMSDUforeachMPDU ............... 25.67 Statisticstoolenhancements .............................................
26 6GHzfrequencybandfeatures .........................................
26.1 6GHzfrequencybandfeatures ...........................................
26.2 Hostarchitecturefor6GHz ..............................................
26.2.1 AP/STAMLME ..............................................
26.3 Impactof6GHzonUMACandfirmware ..................................
26.4 Supportfor6GHzout-of-bandadvertisement ...............................
26.4.1 Guidelinesfor6GHzout-of-bandfunctionality ......................
26.4.2 Host design enhancements for 6 GHz OOB . . . . . . . . . . . . . . . . . . . . . . . . .
26.4.3 High-leveldesignforOOBadvertisement ..........................
26.4.4 RNRTBTToffsetfor6GHz ....................................
26.4.5 CLIenhancementsforin-bandandOOBfeatures ....................
26.4.6 Discovery—Inband ...........................................
26.5 Impactof6GHzoncoreframework .......................................
26.6 Impactof6GHzonregulatoryandDFScomponents ..........................
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
3917
3917
3918
3918
3918
3918
3918
3920
3921
3923
3924
3924
3924
3926
3927
3928
3928
3930
3930
3932
3936
3936
3936
3938
3938
3939
3941
3943
3945
3946
3947
3948
3961
3961
3962
3962
3966
3967
3971
3971
3973
3976
87
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
26.6.1 RegulatoryNotice–6GHzoperation.............................. 3976
26.6.2 Regulatoryoperationsfor6GHz ................................. 3977
26.6.3 RegulatoryAPIchangesfor6GHz ............................... 3982
26.6.4 BDFflagforenablinganddisabling6GHzchannels ................. 3986
26.7 Wiresharkandmonitormodesupportfor6GHz.............................. 3986
26.7.1 Modifiedandnewsubclauses ................................... 3987
26.7.2 Sniffersupportinhostdriverfor6GHz ............................ 3999
26.7.3 Monitormodesupport.......................................... 4001
26.8 CLIenhancementstosupport6GHz ....................................... 4001
26.8.1 NewCLIadditions ............................................ 4001
26.8.2 Changestoexistingcfg80211toolcommands........................ 4002
26.8.3 UCIscriptchanges ............................................ 4003
26.8.4 Changestoexistingexttoolcommands............................. 4003
26.8.5 Changestoexistingwifitoolcommands ............................ 4003
26.8.6 ACFGchanges ............................................... 4006
26.8.7 wlanconfigchangesfor6GHz ................................... 4006
26.9 ACSsupportfor6GHzfrequencyband .................................... 4009
26.10 Out-of-bandsupportformulti-SoCsin6GHzband ........................... 4009 26.10.1 Eliminatedriftfromatime-instant ................................ 4012
26.10.2 TBTT-offset estimation in target SoC - Multi-SoC case with drift . . . . . . . . 4012
26.11 Wi-FiSONsupportfor6GHzfrequencyband ............................... 4013
26.11.1 6GHzbasicWi-FiSONbringup–Backhaulsupport ................. 4013
26.11.2 6GHzfronthaulsupport ........................................ 4014
26.11.3 Wi-FiSONarchitecturefor6GHz ................................ 4016
26.11.4 6GHzbandandfrequency ...................................... 4018
26.11.5 Credentialcloning ............................................. 4018
26.11.6 APsteering .................................................. 4020
26.11.7 Bestuplinkselection ........................................... 4020
26.12 6GHzSTAsidesupportforMBSSID ...................................... 4021
26.13 SupportforWFA6GHznewchannelization ................................ 4022
26.14 6GHzsecuritycompliancewith802.11specification.......................... 4024
26.15 RNRsupportviaApp-IE/APIfor6GHzfrequencyband ....................... 4025
26.15.1 Configure RNR support and selective non-Tx AP inclusion for 6 GHz . . . . 4028
26.15.2 DefaultdriverbehaviorforRNRIE ............................... 4029
26.15.3 Overridingthedefaultdriverbehaviorfor6GHz-onlyAP ............. 4030
26.15.4 Add/updateRNRIEwith6GHzNonTxAPsinFILSframe ........... 4030
26.15.5 Add/updateRNRIEin20TUproberesponseframe .................. 4031
26.15.6 Update6GHzmanagementframesif6GHzonlyAP ................. 4033
26.15.7 FilterNonTxAPinfofromRNRcache ............................ 4034
26.15.8 Selective inclusion of 6 GHz AP (Non Tx) in 6 GHz beacon frames . . . . . 4034
26.16 Commandstoconfigureadditional6GHzsettings ............................ 4035
26.17 Enhancementstostatisticsreportingfor6GHz............................... 4039
26.18 SupportforenablingTxinHEPPDUformatfor6GHzband ................... 4040
80-YA728-6 Rev. YV Confidential – Qualcomm Technologies, Inc. and/or its affiliated companies – May Contain Trade Secrets 88 MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
 2/19/2021 10:15:21 AM Distributed by Compex systems Pte. Ltd. by alex_tiong@compex.com.sg To terry_pang@compex.com.sg
 
 Wireless LAN Driver Version 11.0 for Access Point Programming Guide Contents
26.19 LatestEDthresholdcompliancefor6GHz(ETSI_BRAN) ..................... 4041 26.20 CIEandTPEfor6GHzfrequencyband .................................... 4041